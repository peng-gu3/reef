<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ“ˆ ì˜¤ë‘¥ì´ì‚ ì£¼ì‹ ë§¤ë§¤ì¼ì§€</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { background:#0f172a; color:#f1f5f9; font-family:"Noto Sans KR",sans-serif; margin:0; padding:20px;}
  h1 { text-align:center; margin-bottom:20px;}
  .container { background:#1e293b; border-radius:14px; padding:20px; max-width:900px; margin:auto;}
  input,select,button { background:#334155; color:white; border:none; border-radius:6px; padding:8px; margin:4px; width:100%;}
  button { background:#2563eb; cursor:pointer;}
  button:hover { background:#1d4ed8;}
  .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:8px;}
  .preview { text-align:center; margin:10px 0; padding:10px; border-radius:8px;}
  .profit { background:rgba(34,197,94,0.2); color:#4ade80;}
  .loss { background:rgba(239,68,68,0.2); color:#f87171;}
  .list-item { background:#334155; padding:8px 12px; border-radius:6px; margin:4px 0;}
  .list-header {display:flex; justify-content:space-between; align-items:center;}
  .btn-sm { background:#475569; border:none; color:#f1f5f9; border-radius:4px; padding:4px 8px; margin-left:4px; cursor:pointer; font-size:12px;}
  .btn-sm:hover { background:#64748b;}
  .green{color:#4ade80;} .red{color:#f87171;}
  canvas{background:#1e293b;border-radius:8px;width:100%;max-height:300px;margin-top:10px;}
</style>
</head>
<body>
  <h1>ğŸ“ˆ í­êµ¬ë‹˜ ì£¼ì‹ ë§¤ë§¤ì¼ì§€</h1>
  <div class="container">
    <div class="grid">
      <input id="stock" placeholder="ì¢…ëª©ëª…" />
      <input id="date" type="date" />
      <select id="type"><option>ë§¤ìˆ˜</option><option>ë§¤ë„</option></select>
      <input id="qty" type="number" placeholder="ìˆ˜ëŸ‰(ì£¼)" />
      <input id="buy" type="number" placeholder="ë§¤ì…ê°€(ì›)" />
      <input id="sell" type="number" placeholder="ë§¤ë„ê°€(ì›)" />
      <input id="fee" type="number" placeholder="ìˆ˜ìˆ˜ë£Œ(ì›)" />
      <input id="note" placeholder="ë¹„ê³ " />
    </div>
    <div id="preview" class="preview"></div>
    <button id="addTrade">ê¸°ë¡ ì¶”ê°€</button>

    <h3>ğŸ“œ ê±°ë˜ ëª©ë¡</h3>
    <div id="tradeList"></div>

    <h3>ğŸ“Š ì†ìµ ë¹„ìœ¨</h3>
    <canvas id="chartDonut"></canvas>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const addTradeBtn = document.getElementById("addTrade");
  const tradeList = document.getElementById("tradeList");
  const preview = document.getElementById("preview");
  const chartDonut = document.getElementById("chartDonut");
  let donutChart;
  let editIndex = null;

  const trades = JSON.parse(localStorage.getItem("stock_trades") || "[]");

  function saveTrades() {
    localStorage.setItem("stock_trades", JSON.stringify(trades));
  }

  function refreshUI() {
    tradeList.innerHTML = trades
      .map(
        (t, i) => `
      <div class="list-item">
        <div class="list-header">
          <span>${t.date} | ${t.stock} (${t.type})</span>
          <div>
            <button class="btn-sm" data-index="${i}" data-action="edit">âœ ìˆ˜ì •</button>
            <button class="btn-sm" data-index="${i}" data-action="delete">ğŸ—‘ ì‚­ì œ</button>
          </div>
        </div>
        <span class="${t.profit >= 0 ? "green" : "red"}">
          ${t.profit.toLocaleString()}ì› (${t.rate.toFixed(2)}%)
        </span>
      </div>`
      )
      .join("");
    drawDonut();
  }

  function editTrade(index) {
    const t = trades[index];
    document.getElementById("stock").value = t.stock;
    document.getElementById("date").value = t.date;
    document.getElementById("type").value = t.type;
    document.getElementById("qty").value = t.qty;
    document.getElementById("buy").value = t.buy;
    document.getElementById("sell").value = t.sell;
    document.getElementById("fee").value = t.fee;
    document.getElementById("note").value = t.note;
    editIndex = index;
    addTradeBtn.textContent = "âœ… ìˆ˜ì • ì™„ë£Œ";
  }

  function deleteTrade(index) {
    if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      trades.splice(index, 1);
      saveTrades();
      refreshUI();
    }
  }

  function addTrade() {
    const stock = document.getElementById("stock").value.trim();
    const date = document.getElementById("date").value;
    const type = document.getElementById("type").value;
    const qty = parseFloat(document.getElementById("qty").value) || 0;
    const buy = parseFloat(document.getElementById("buy").value) || 0;
    const sell = parseFloat(document.getElementById("sell").value) || 0;
    const fee = parseFloat(document.getElementById("fee").value) || 0;
    const note = document.getElementById("note").value.trim();

    if (!stock || !date || !qty) {
      alert("ì¢…ëª©ëª…, ë‚ ì§œ, ìˆ˜ëŸ‰ì€ í•„ìˆ˜ì…ë‹ˆë‹¤!");
      return;
    }
    if (type === "ë§¤ìˆ˜" && !buy) {
      alert("ë§¤ì…ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }
    if (type === "ë§¤ë„" && !sell) {
      alert("ë§¤ë„ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }

    const profit = type === "ë§¤ë„" ? (sell - buy) * qty - fee : 0;
    const rate = type === "ë§¤ë„" && buy > 0 ? ((sell - buy) / buy) * 100 : 0;

    const newTrade = { stock, date, type, qty, buy, sell, fee, profit, rate, note };

    if (editIndex !== null) {
      trades[editIndex] = newTrade;
      editIndex = null;
      addTradeBtn.textContent = "ê¸°ë¡ ì¶”ê°€";
    } else {
      trades.push(newTrade);
    }

    saveTrades();
    refreshUI();
    document.querySelectorAll("input").forEach((i) => (i.value = ""));
    preview.textContent = "";
  }

  function drawDonut() {
    if (donutChart) donutChart.destroy();
    const win = trades.filter((t) => t.profit > 0).length;
    const lose = trades.filter((t) => t.profit < 0).length;
    const even = trades.length - win - lose;
    donutChart = new Chart(chartDonut, {
      type: "doughnut",
      data: {
        labels: ["ìµì ˆ", "ì†ì ˆ", "ë³´í•©"],
        datasets: [
          {
            data: [win, lose, even],
            backgroundColor: ["#22c55e", "#ef4444", "#94a3b8"],
          },
        ],
      },
      options: { plugins: { legend: { labels: { color: "#f1f5f9" } } } },
    });
  }

  ["buy", "sell", "qty"].forEach((id) => {
    document.getElementById(id).addEventListener("input", () => {
      const b = parseFloat(buy.value) || 0;
      const s = parseFloat(sell.value) || 0;
      const q = parseFloat(qty.value) || 0;
      if (b && s && q) {
        const p = (s - b) * q;
        const r = ((s - b) / b) * 100;
        preview.textContent = `ì˜ˆìƒ ì†ìµ: ${p.toLocaleString()}ì› (${r.toFixed(2)}%)`;
        preview.className = "preview " + (p >= 0 ? "profit" : "loss");
      } else {
        preview.textContent = "";
        preview.className = "preview";
      }
    });
  });

  tradeList.addEventListener("click", (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;
    const index = parseInt(btn.dataset.index);
    const action = btn.dataset.action;
    if (action === "edit") editTrade(index);
    else if (action === "delete") deleteTrade(index);
  });

  addTradeBtn.addEventListener("click", addTrade);

  refreshUI();
});
</script>
</body>
</html>
