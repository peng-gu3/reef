<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›”ë³„ ìë™í†µê³„ ê°€ê³„ë¶€</title>
    <style>
        body { font-family: 'Pretendard', 'Malgun Gothic', sans-serif; background-color: #f0f2f5; padding: 20px; margin: 0; color:#333; }
        .container { max-width: 1000px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); }
        h2 { text-align: center; color: #333; margin-bottom: 20px; font-weight: 800; letter-spacing: -1px;}

        /* ì „ì²´ ìš”ì•½ ì¹´ë“œ */
        .dashboard { display: flex; justify-content: space-between; gap: 15px; margin-bottom: 30px; }
        .card { flex: 1; padding: 20px; border-radius: 10px; text-align: center; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card h3 { margin: 0 0 10px 0; font-size: 0.95rem; opacity: 0.9; font-weight: 400; }
        .card p { margin: 0; font-size: 1.6rem; font-weight: bold; }
        .card.income { background: linear-gradient(135deg, #3a7bd5 0%, #3a6073 100%); }
        .card.expense { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
        .card.balance { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }

        /* ì›”ë³„ í†µê³„ ì˜ì—­ (ìƒˆë¡œ ì¶”ê°€ë¨) */
        .monthly-section { margin-bottom: 30px; border: 1px solid #e1e4e8; border-radius: 10px; overflow: hidden; }
        .monthly-header { background: #f8f9fa; padding: 10px 20px; font-weight: bold; border-bottom: 1px solid #e1e4e8; color: #555; }
        .monthly-table { width: 100%; border-collapse: collapse; }
        .monthly-table th, .monthly-table td { padding: 10px; text-align: center; border-bottom: 1px solid #eee; font-size: 14px; }
        .monthly-table th { background: #fff; color: #777; font-weight: 600; }
        .monthly-row:last-child td { border-bottom: none; }
        .net-profit.plus { color: #28a745; font-weight: bold; }
        .net-profit.minus { color: #dc3545; font-weight: bold; }

        /* ì…ë ¥ í¼ */
        .input-group { background-color: #f1f3f5; padding: 20px; border-radius: 10px; display: grid; grid-template-columns: 100px 130px 120px 1fr 150px 100px 80px; gap: 10px; align-items: center; margin-bottom: 20px; border: 1px solid #e9ecef;}
        input, select { padding: 0 10px; border: 1px solid #ddd; border-radius: 6px; height: 42px; box-sizing: border-box; font-size: 14px; outline: none; }
        input:focus, select:focus { border-color: #3a7bd5; }
        
        button.add-btn { background-color: #333; color: white; border: none; border-radius: 6px; cursor: pointer; height: 42px; font-weight: bold; transition: 0.2s; }
        button.add-btn:hover { background-color: #000; }

        /* ìƒë‹¨ ì´ˆê¸°í™” ë²„íŠ¼ */
        .header-controls { position: absolute; right: 0; top: 0; }
        button.reset-btn { background-color: #adb5bd; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        button.reset-btn:hover { background-color: #868e96; }

        /* ë©”ì¸ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” */
        .list-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        .list-table th { background-color: #f8f9fa; color: #495057; font-weight: 600; padding: 12px; border-bottom: 2px solid #e9ecef; }
        .list-table td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; font-size: 15px; color: #444; }
        
        .money-income { color: #3a7bd5; font-weight: bold; }
        .money-expense { color: #ff4b2b; font-weight: bold; }
        
        .delete-btn { background-color: #ff6b6b; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        
        @media (max-width: 900px) {
            .input-group { grid-template-columns: 1fr 1fr; }
            .input-group > input[type="text"]#descInput { grid-column: span 2; }
            button.add-btn { grid-column: span 2; }
            .dashboard { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container">
    <div style="position:relative;">
        <h2>ğŸ“Š ì›”ë³„ ìë™í†µê³„ ê°€ê³„ë¶€</h2>
        <div class="header-controls">
            <button class="reset-btn" onclick="resetAllData()">ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
    </div>

    <div class="dashboard">
        <div class="card income">
            <h3>ì „ì²´ ì´ ìˆ˜ì…</h3>
            <p id="totalIncomeDisplay">0ì›</p>
        </div>
        <div class="card expense">
            <h3>ì „ì²´ ì´ ì§€ì¶œ</h3>
            <p id="totalExpenseDisplay">0ì›</p>
        </div>
        <div class="card balance">
            <h3>í˜„ì¬ ì´ ì”ì•¡</h3>
            <p id="balanceDisplay">0ì›</p>
        </div>
    </div>

    <div class="monthly-section">
        <div class="monthly-header">ğŸ“… ì›”ë³„ ìš”ì•½ ë¦¬í¬íŠ¸</div>
        <table class="monthly-table">
            <thead>
                <tr>
                    <th>ê¸°ê°„ (ì›”)</th>
                    <th>ìˆ˜ì… í•©ê³„</th>
                    <th>ì§€ì¶œ í•©ê³„</th>
                    <th>ì›” ì”ì•¡ (ìˆ˜ì…-ì§€ì¶œ)</th>
                </tr>
            </thead>
            <tbody id="monthlyTableBody">
                </tbody>
        </table>
    </div>

    <div class="input-group">
        <select id="typeInput" onchange="changeCategory()" style="font-weight:bold; color:#ff4b2b;">
            <option value="income" style="color:#3a7bd5;">ğŸ”µ ìˆ˜ì…</option>
            <option value="expense" selected style="color:#ff4b2b;">ğŸ”´ ì§€ì¶œ</option>
        </select>
        <input type="date" id="dateInput">
        <select id="categoryInput"></select>
        <input type="text" id="descInput" placeholder="ë‚´ìš© (ì˜ˆ: ì ì‹¬ê°’)">
        <input type="text" id="amountInput" placeholder="ê¸ˆì•¡" onkeyup="inputNumberFormat(this)" style="text-align:right;">
        <input type="text" id="noteInput" placeholder="ë¹„ê³ ">
        <button class="add-btn" onclick="addEntry()">ë“±ë¡</button>
    </div>

    <table class="list-table">
        <colgroup>
            <col width="12%"><col width="10%"><col width="12%"><col width="*"><col width="15%"><col width="15%"><col width="8%">
        </colgroup>
        <thead>
            <tr>
                <th>ë‚ ì§œ</th><th>êµ¬ë¶„</th><th>ë¶„ë¥˜</th><th>ë‚´ìš©</th><th>ê¸ˆì•¡</th><th>ë¹„ê³ </th><th>ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody id="accountTableBody"></tbody>
    </table>
</div>

<script>
    document.getElementById('dateInput').valueAsDate = new Date();
    
    const categories = {
        income: ["ì›”ê¸‰", "ë³´ë„ˆìŠ¤", "ìš©ëˆ", "ê¸ˆìœµìˆ˜ìµ", "ì‚¬ì—…ìˆ˜ì…", "ê¸°íƒ€"],
        expense: ["ì‹ë¹„", "êµí†µ/ì°¨ëŸ‰", "ì‡¼í•‘", "ì£¼ê±°/í†µì‹ ", "ì˜ë£Œ/ê±´ê°•", "ì €ì¶•/íˆ¬ì", "ë¬¸í™”/ì—¬ê°€", "ê¸°íƒ€"]
    };

    function changeCategory() {
        const type = document.getElementById('typeInput').value;
        const categorySelect = document.getElementById('categoryInput');
        
        categorySelect.innerHTML = "";
        categories[type].forEach(item => {
            const option = document.createElement('option');
            option.value = item;
            option.innerText = item;
            categorySelect.appendChild(option);
        });

        const typeInput = document.getElementById('typeInput');
        typeInput.style.color = (type === 'income') ? "#3a7bd5" : "#ff4b2b";
    }

    function inputNumberFormat(obj) { obj.value = comma(uncomma(obj.value)); }
    function comma(str) { return String(str).replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,'); }
    function uncomma(str) { return String(str).replace(/[^\d]+/g, ''); }

    // --- ë°ì´í„° ì €ì¥ ë° ë¡œë“œ ë¡œì§ ---
    function saveToLocal() {
        const rows = document.querySelectorAll('#accountTableBody tr');
        const dataList = [];

        // í™”ë©´ì— ìˆëŠ” í…Œì´ë¸” ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë§Œë“¦ (í™”ë©´ ìˆœì„œ = ìµœì‹ ìˆœ)
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            const amountCell = cells[4];
            
            dataList.push({
                date: cells[0].innerText,
                type: amountCell.getAttribute('data-type'),
                category: cells[2].innerText,
                desc: cells[3].innerText,
                amount: amountCell.getAttribute('data-amount'),
                note: cells[5].innerText
            });
        });

        localStorage.setItem('myAccountBook_v2', JSON.stringify(dataList));
        
        // ì €ì¥í•  ë•Œ ë§ˆë‹¤ í†µê³„ ì—…ë°ì´íŠ¸
        updateDashboard();
        updateMonthlyStats(dataList);
    }

    function loadFromLocal() {
        const savedData = localStorage.getItem('myAccountBook_v2');
        if (!savedData) return;

        const dataList = JSON.parse(savedData);
        const tableBody = document.getElementById('accountTableBody');
        tableBody.innerHTML = ""; 

        // ì €ì¥ëœ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ì—­ìˆœìœ¼ë¡œ(ì €ì¥ì€ ìµœì‹ ìˆœì´ë¯€ë¡œ) ë¿Œë¦´ í•„ìš” ì—†ì´ ìˆœì„œëŒ€ë¡œ
        // ë‹¤ë§Œ addEntryê°€ ìœ„ë¡œ ìŒ“ëŠ” ë°©ì‹ì´ë¯€ë¡œ, ì—¬ê¸°ì„  forEachë¡œ ë‹¨ìˆœ appendí•˜ë©´ ë¨.
        
        dataList.forEach(data => {
            const row = document.createElement('tr');
            const typeText = (data.type === 'income') ? "ìˆ˜ì…" : "ì§€ì¶œ";
            const classType = (data.type === 'income') ? "money-income" : "money-expense";
            const sign = (data.type === 'income') ? "+" : "-";
            const typeColor = (data.type === 'income') ? "#3a7bd5" : "#ff4b2b";

            row.innerHTML = `
                <td>${data.date}</td>
                <td style="color:${typeColor}">${typeText}</td>
                <td>${data.category}</td>
                <td style="text-align:left; padding-left:20px;">${data.desc}</td>
                <td class="${classType}" data-type="${data.type}" data-amount="${data.amount}">
                    ${sign} ${comma(data.amount)}
                </td>
                <td>${data.note}</td>
                <td><button class="delete-btn" onclick="deleteRow(this)">ì‚­ì œ</button></td>
            `;
            tableBody.appendChild(row); // ë¡œë”©í•  ë• ì•„ë˜ë¡œ ë¶™ì„ (ì´ë¯¸ ì •ë ¬ëœ ë°ì´í„°ë¼ ê°€ì •)
        });

        updateDashboard();
        updateMonthlyStats(dataList);
    }

    // --- í•µì‹¬: ì›”ë³„ í†µê³„ ê³„ì‚° í•¨ìˆ˜ ---
    function updateMonthlyStats(dataList) {
        if(!dataList) return;

        // 1. ì›”ë³„ë¡œ ê·¸ë£¹í™” ( { "2023-10": {income:0, expense:0}, ... } )
        let stats = {};

        dataList.forEach(item => {
            // ë‚ ì§œ ì• 7ìë¦¬ (YYYY-MM)ë§Œ ìë¦„
            let monthKey = item.date.substring(0, 7); 
            
            if(!stats[monthKey]) {
                stats[monthKey] = { income: 0, expense: 0 };
            }

            let amt = parseInt(item.amount);
            if(item.type === 'income') {
                stats[monthKey].income += amt;
            } else {
                stats[monthKey].expense += amt;
            }
        });

        // 2. í‚¤(ì›”)ë¥¼ ì •ë ¬ (ìµœì‹  ì›”ì´ ë¨¼ì € ì˜¤ë„ë¡)
        let sortedMonths = Object.keys(stats).sort().reverse();

        // 3. HTML ê·¸ë¦¬ê¸°
        const monthlyBody = document.getElementById('monthlyTableBody');
        monthlyBody.innerHTML = "";

        if(sortedMonths.length === 0) {
            monthlyBody.innerHTML = "<tr><td colspan='4' style='padding:20px; color:#999;'>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ì…/ì§€ì¶œì„ ë“±ë¡í•´ë³´ì„¸ìš”!</td></tr>";
            return;
        }

        sortedMonths.forEach(month => {
            let s = stats[month];
            let net = s.income - s.expense;
            let netClass = net >= 0 ? "plus" : "minus";
            let netSign = net >= 0 ? "+" : "";

            const row = document.createElement('tr');
            row.className = "monthly-row";
            row.innerHTML = `
                <td style="font-weight:bold;">${month}</td>
                <td style="color:#3a7bd5;">${comma(s.income)}ì›</td>
                <td style="color:#ff4b2b;">${comma(s.expense)}ì›</td>
                <td class="net-profit ${netClass}">${netSign}${comma(net)}ì›</td>
            `;
            monthlyBody.appendChild(row);
        });
    }

    function addEntry() {
        const type = document.getElementById('typeInput').value;
        const date = document.getElementById('dateInput').value;
        const category = document.getElementById('categoryInput').value;
        const desc = document.getElementById('descInput').value;
        const amountStr = document.getElementById('amountInput').value;
        const note = document.getElementById('noteInput').value;
        const amount = parseInt(uncomma(amountStr));

        if (!date || !desc || isNaN(amount) || amount === 0) {
            alert("ë‚´ìš©ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        const tableBody = document.getElementById('accountTableBody');
        const row = tableBody.insertRow(0); // ìƒˆ í•­ëª©ì€ ë§¨ ìœ„ì—

        const typeText = (type === 'income') ? "ìˆ˜ì…" : "ì§€ì¶œ";
        const classType = (type === 'income') ? "money-income" : "money-expense";
        const sign = (type === 'income') ? "+" : "-";

        row.innerHTML = `
            <td>${date}</td>
            <td style="color:${type === 'income' ? '#3a7bd5' : '#ff4b2b'}">${typeText}</td>
            <td>${category}</td>
            <td style="text-align:left; padding-left:20px;">${desc}</td>
            <td class="${classType}" data-type="${type}" data-amount="${amount}">
                ${sign} ${comma(amount)}
            </td>
            <td>${note}</td>
            <td><button class="delete-btn" onclick="deleteRow(this)">ì‚­ì œ</button></td>
        `;

        // ì…ë ¥ì°½ ì´ˆê¸°í™”
        document.getElementById('descInput').value = '';
        document.getElementById('amountInput').value = '';
        document.getElementById('noteInput').value = '';
        document.getElementById('descInput').focus();

        saveToLocal(); 
    }

    function deleteRow(btn) {
        btn.parentNode.parentNode.remove();
        saveToLocal();
    }

    function updateDashboard() {
        const rows = document.querySelectorAll('#accountTableBody tr td[data-amount]');
        let totalIncome = 0;
        let totalExpense = 0;

        rows.forEach(td => {
            const amount = parseInt(td.getAttribute('data-amount'));
            const type = td.getAttribute('data-type');
            if (type === 'income') totalIncome += amount;
            else totalExpense += amount;
        });

        document.getElementById('totalIncomeDisplay').innerText = comma(totalIncome) + "ì›";
        document.getElementById('totalExpenseDisplay').innerText = comma(totalExpense) + "ì›";
        document.getElementById('balanceDisplay').innerText = comma(totalIncome - totalExpense) + "ì›";
    }

    function resetAllData() {
        if(confirm("â— ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem('myAccountBook_v2');
            document.getElementById('accountTableBody').innerHTML = "";
            document.getElementById('monthlyTableBody').innerHTML = "";
            updateDashboard();
        }
    }

    // ì´ˆê¸° ì‹¤í–‰
    changeCategory();
    loadFromLocal();
</script>

</body>
</html>
