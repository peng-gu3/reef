<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>해수어항 관리 도징 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .result-item { padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 0.5rem; font-weight: 500; }
    .result-good  { background-color: #E6FFFA; color: #234E52; border-left: 4px solid #38B2AC; }
    .result-low   { background-color: #FFF5F5; color: #C53030; border-left: 4px solid #FC8181; }
    .result-high  { background-color: #FAF5FF; color: #6B46C1; border-left: 4px solid #B794F4; }
    .result-action{ background-color: #FEFCBF; color: #744210; border-left: 4px solid #F6E05E; }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4 max-w-5xl">
    <!-- 어항 정보 입력 영역 -->
    <div class="bg-white p-6 rounded shadow mb-6">
      <h2 class="text-xl font-bold mb-4">어항 정보 입력</h2>
      <div class="grid grid-cols-2 gap-3">
        <input id="date" type="date" class="border p-2 rounded" />
        <input id="vol" placeholder="용량(L)" class="border p-2 rounded" value="160" />
        <input id="temp" placeholder="온도(°C)" class="border p-2 rounded" />
        <input id="salinity" placeholder="염도(ppt)" class="border p-2 rounded" />
        <input id="ph" placeholder="pH" class="border p-2 rounded" />
        <input id="ca" placeholder="Ca(ppm)" class="border p-2 rounded" />
        <input id="mg" placeholder="Mg(ppm)" class="border p-2 rounded" />
        <input id="kh" placeholder="KH(dKH)" class="border p-2 rounded" />
        <input id="no2" placeholder="NO₂(ppm)" class="border p-2 rounded" />
        <input id="no3" placeholder="NO₃(ppm)" class="border p-2 rounded" />
        <input id="po4" placeholder="PO₄(ppm)" class="border p-2 rounded" />
      </div>
      <div class="flex flex-wrap space-x-2 mt-4">
        <button id="calculate-btn" class="flex-1 bg-blue-600 text-white py-2 rounded">계산하기</button>
        <button id="save-btn" class="flex-1 bg-green-600 text-white py-2 rounded">기록 저장</button>
        <button id="graph-btn" class="flex-1 bg-purple-600 text-white py-2 rounded">그래프 보기</button>
        <button id="ai-btn" class="flex-1 bg-indigo-600 text-white py-2 rounded">AI 어드바이스</button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">계산 결과 및 권장 사항</h2>
        <div id="results-output" class="space-y-2"></div>
      </div>

      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">저장된 기록</h2>
        <div class="flex justify-end mb-2">
          <button id="clear-logs-btn" class="bg-red-500 text-white px-4 py-2 rounded">기록 초기화</button>
        </div>
        <table class="w-full text-sm">
          <thead><tr><th>날짜</th><th>온도</th><th>염도</th><th>pH</th><th>Ca</th><th>Mg</th><th>KH</th><th>NO₂</th><th>NO₃</th><th>PO₄</th><th>삭제</th></tr></thead>
          <tbody id="log-table-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const graphWindowFeatures = 'width=1000,height=600,resizable,scrollbars';
    const aiWindowFeatures = 'width=600,height=400,resizable,scrollbars';

    document.getElementById('graph-btn').onclick = () => {
      const tbody = document.getElementById('log-table-body');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      if (rows.length === 0) return alert('기록이 없습니다.');

      const labels = rows.map(row => row.children[0].textContent);
      const caData = rows.map(row => parseFloat(row.children[4].textContent));
      const khData = rows.map(row => parseFloat(row.children[6].textContent));
      const no3Data = rows.map(row => parseFloat(row.children[8].textContent));

      const graphWin = window.open('', '그래프보기', graphWindowFeatures);
      graphWin.document.write(`
        <html><head><title>그래프 보기</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        </head><body>
        <canvas id="chart" width="900" height="500"></canvas>
        <script>
          const ctx = document.getElementById('chart').getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: ${JSON.stringify(labels)},
              datasets: [
                { label: 'Ca', data: ${JSON.stringify(caData)}, borderColor: 'blue', fill: false },
                { label: 'KH', data: ${JSON.stringify(khData)}, borderColor: 'green', fill: false },
                { label: 'NO₃', data: ${JSON.stringify(no3Data)}, borderColor: 'red', fill: false },
              ]
            },
            options: { responsive: true }
          });
        </script>
        </body></html>
      `);
    };

    document.getElementById('ai-btn').onclick = () => {
      const temp = parseFloat(document.getElementById('temp').value);
      const ca = parseFloat(document.getElementById('ca').value);
      const kh = parseFloat(document.getElementById('kh').value);
      const no3 = parseFloat(document.getElementById('no3').value);
      const po4 = parseFloat(document.getElementById('po4').value);

      let advice = '';
      if (ca < 415) advice += '- 칼슘 보충이 필요합니다.\n';
      if (kh < 7.7) advice += '- KH 보충이 필요합니다.\n';
      if (no3 < 0.5) advice += '- 질산염(NO₃) 농도가 낮아 Nitro 도징 권장.\n';
      if (po4 < 0.03) advice += '- 인산염(PO₄) 농도가 낮아 Phos 도징 권장.\n';
      if (temp > 26.5) advice += '- 수온이 높습니다. 냉각기나 환기 확인 필요.\n';

      const aiWin = window.open('', 'AI어드바이스', aiWindowFeatures);
      aiWin.document.write('<html><head><title>AI 어드바이스</title></head><body><h2>AI 어드바이스</h2><pre>' + advice + '</pre></body></html>');
    };
  </script>
</body>
</html>
