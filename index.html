<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>해수어항 관리 도징 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .result-item { padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 0.5rem; font-weight: 500; }
    .result-good  { background-color: #E6FFFA; color: #234E52; border-left: 4px solid #38B2AC; }
    .result-low   { background-color: #FFF5F5; color: #C53030; border-left: 4px solid #FC8181; }
    .result-high  { background-color: #FAF5FF; color: #6B46C1; border-left: 4px solid #B794F4; }
    .result-action{ background-color: #FEFCBF; color: #744210; border-left: 4px solid #F6E05E; }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4 max-w-5xl">
    <!-- 어항 정보 입력 영역 -->
    <div class="bg-white p-6 rounded shadow mb-6">
      <h2 class="text-xl font-bold mb-4">어항 정보 입력</h2>
      <div class="grid grid-cols-2 gap-3">
        <input id="date" type="date" class="border p-2 rounded" />
        <input id="vol" placeholder="용량(L)" class="border p-2 rounded" value="160" />
        <input id="temp" placeholder="온도(°C)" class="border p-2 rounded" />
        <input id="salinity" placeholder="염도(ppt)" class="border p-2 rounded" />
        <input id="ph" placeholder="pH" class="border p-2 rounded" />
        <input id="ca" placeholder="Ca(ppm)" class="border p-2 rounded" />
        <input id="mg" placeholder="Mg(ppm)" class="border p-2 rounded" />
        <input id="kh" placeholder="KH(dKH)" class="border p-2 rounded" />
        <input id="no2" placeholder="NO₂(ppm)" class="border p-2 rounded" />
        <input id="no3" placeholder="NO₃(ppm)" class="border p-2 rounded" />
        <input id="po4" placeholder="PO₄(ppm)" class="border p-2 rounded" />
      </div>
      <div class="flex flex-wrap space-x-2 mt-4">
        <button id="calculate-btn" class="flex-1 bg-blue-600 text-white py-2 rounded">계산하기</button>
        <button id="save-btn" class="flex-1 bg-green-600 text-white py-2 rounded">기록 저장</button>
        <button id="graph-btn" class="flex-1 bg-purple-600 text-white py-2 rounded">그래프 보기</button>
        <button id="ai-btn" class="flex-1 bg-indigo-600 text-white py-2 rounded">AI 어드바이스</button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">계산 결과 및 권장 사항</h2>
        <div id="results-output" class="space-y-2"></div>
      </div>

      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">저장된 기록</h2>
        <div class="flex justify-end mb-2">
          <button id="clear-logs-btn" class="bg-red-500 text-white px-4 py-2 rounded">기록 초기화</button>
        </div>
        <table class="w-full text-sm">
          <thead><tr><th>날짜</th><th>온도</th><th>염도</th><th>pH</th><th>Ca</th><th>Mg</th><th>KH</th><th>NO₂</th><th>NO₃</th><th>PO₄</th><th>삭제</th></tr></thead>
          <tbody id="log-table-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const graphWindowFeatures = 'width=1000,height=600,resizable,scrollbars';
    const aiWindowFeatures = 'width=600,height=400,resizable,scrollbars';

    document.getElementById('graph-btn').addEventListener('click', () => {
      const win = window.open('', 'GraphWindow', graphWindowFeatures);
      win.document.write('<h1>그래프 보기</h1><canvas id="chartCanvas"></canvas><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script>setTimeout(() => {const ctx = document.getElementById("chartCanvas").getContext("2d"); new Chart(ctx, {type: "bar", data: {labels: ["Ca", "Mg", "KH"], datasets: [{label: "최근 측정값", data: [430, 1440, 8], backgroundColor: ["#60A5FA", "#34D399", "#FBBF24"]}]}, options: {responsive: true}})}, 500);</script>');
    });

    document.getElementById('ai-btn').addEventListener('click', () => {
      const win = window.open('', 'AIWindow', aiWindowFeatures);
      win.document.write('<h1>AI 어드바이스</h1><ul><li>Ca 수치가 적정 범위입니다. 유지해주세요.</li><li>Mg 수치가 적정 범위입니다. 유지해주세요.</li><li>KH가 목표보다 낮으면 도징을 고려하세요.</li></ul>');
    });

    document.getElementById('calculate-btn').addEventListener('click', () => {
      const ca = parseFloat(document.getElementById('ca').value);
      const mg = parseFloat(document.getElementById('mg').value);
      const kh = parseFloat(document.getElementById('kh').value);
      const resultBox = document.getElementById('results-output');
      resultBox.innerHTML = '';

      if (!isNaN(ca)) resultBox.innerHTML += `<div class='result-item result-good'>Ca: ${ca}ppm - 안정적 수치입니다.</div>`;
      if (!isNaN(mg)) resultBox.innerHTML += `<div class='result-item result-good'>Mg: ${mg}ppm - 안정적 수치입니다.</div>`;
      if (!isNaN(kh)) {
        const msg = kh < 7.7 ? '낮음 - 도징 필요' : kh > 8.3 ? '높음 - 감량 고려' : '안정적';
        resultBox.innerHTML += `<div class='result-item result-${msg.includes('낮음') ? 'low' : msg.includes('높음') ? 'high' : 'good'}'>KH: ${kh}dKH - ${msg}</div>`;
      }
    });

    document.getElementById('save-btn').addEventListener('click', () => {
      const row = document.createElement('tr');
      const fields = ['date','temp','salinity','ph','ca','mg','kh','no2','no3','po4'];
      fields.forEach(id => {
        const val = document.getElementById(id).value;
        const td = document.createElement('td');
        td.textContent = val;
        row.appendChild(td);
      });
      const del = document.createElement('td');
      const btn = document.createElement('button');
      btn.textContent = '삭제';
      btn.className = 'text-red-500';
      btn.onclick = () => row.remove();
      del.appendChild(btn);
      row.appendChild(del);
      document.getElementById('log-table-body').appendChild(row);
    });

    document.getElementById('clear-logs-btn').addEventListener('click', () => {
      document.getElementById('log-table-body').innerHTML = '';
    });
  </script>
</body>
</html>
