<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>해수어항 관리 도징 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4 max-w-4xl">
    <!-- 입력 영역 -->
    <section class="bg-white p-6 rounded shadow mb-6">
      <h2 class="text-xl font-bold mb-4">어항 정보 입력</h2>
      <div class="grid grid-cols-2 gap-4">
        <label>날짜<input id="date" type="date" class="border p-2 rounded w-full"></label>
        <label>용량 (L)<input id="vol" type="number" class="border p-2 rounded w-full" value="160"></label>
        <label>온도 (°C)<input id="temp" type="number" step="0.1" class="border p-2 rounded w-full"></label>
        <label>염도 (ppt)<input id="salinity" type="number" step="0.1" class="border p-2 rounded w-full"></label>
        <label>pH<input id="ph" type="number" step="0.1" class="border p-2 rounded w-full"></label>
        <label>Ca (ppm)<input id="ca" type="number" class="border p-2 rounded w-full"></label>
        <label>Mg (ppm)<input id="mg" type="number" class="border p-2 rounded w-full"></label>
        <label>KH (dKH)<input id="kh" type="number" step="0.1" class="border p-2 rounded w-full"></label>
        <label>NO₂ (ppm)<input id="no2" type="number" step="0.01" class="border p-2 rounded w-full"></label>
        <label>NO₃ (ppm)<input id="no3" type="number" step="0.1" class="border p-2 rounded w-full"></label>
        <label>PO₄ (ppm)<input id="po4" type="number" step="0.01" class="border p-2 rounded w-full"></label>
      </div>
      <div class="mt-4 flex space-x-2">
        <button id="btn-calc" class="flex-1 bg-blue-600 text-white py-2 rounded">계산하기</button>
        <button id="btn-save" class="flex-1 bg-green-600 text-white py-2 rounded">기록 저장</button>
        <button id="btn-graph" class="flex-1 bg-purple-600 text-white py-2 rounded">그래프 보기</button>
        <button id="btn-ai" class="flex-1 bg-indigo-600 text-white py-2 rounded">AI 어드바이스</button>
        <button id="btn-clear" class="flex-1 bg-red-500 text-white py-2 rounded">기록 초기화</button>
      </div>
    </section>
    <!-- 결과 / 기록 영역 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">계산 결과 및 권장 사항</h2>
        <div id="results" class="space-y-2"></div>
      </div>
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">저장된 기록</h2>
        <table class="w-full text-sm border-collapse">
          <thead class="bg-gray-200"><tr><th>날짜</th><th>온도</th><th>염도</th><th>pH</th><th>Ca</th><th>Mg</th><th>KH</th><th>NO₂</th><th>NO₃</th><th>PO₄</th><th>삭제</th></tr></thead>
          <tbody id="log-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // 기준값
    const 기준 = {
      temp:[25.5,26.5], salinity:[34,35], ph:[8.0,8.3],
      ca:[415,430], mg:[1400,1440], kh:[7.7,8.0],
      no2:[0,0], no3:[0.5,2.0], po4:[0.03,0.08]
    };
    // 날짜 초기화
    window.onload = ()=>{
      document.getElementById('date').value = new Date().toISOString().slice(0,10);
    };

    document.getElementById('btn-calc').onclick = ()=>{
      const fields=['temp','salinity','ph','ca','mg','kh','no2','no3','po4'];
      const out=document.getElementById('results'); out.innerHTML='';
      fields.forEach(id=>{
        const v=parseFloat(document.getElementById(id).value);
        if(!isNaN(v)){
          const [min,max]=기준[id];
          let cls,msg;
          if(v<min){cls='result-low';msg=`${id.toUpperCase()}: ${v} → 미달 (보충)`;} 
          else if(v>max){cls='result-high';msg=`${id.toUpperCase()}: ${v} → 초과 (감량)`;} 
          else {cls='result-good';msg=`${id.toUpperCase()}: ${v} → 안정`;} 
          const div=document.createElement('div'); div.className=`result-item ${cls}`; div.textContent=msg;
          out.appendChild(div);
        }
      });
    };

    document.getElementById('btn-save').onclick = ()=>{
      const row=document.createElement('tr');
      ['date','temp','salinity','ph','ca','mg','kh','no2','no3','po4'].forEach(id=>{
        const td=document.createElement('td'); td.textContent=document.getElementById(id).value; row.appendChild(td);
      });
      const td=document.createElement('td'),btn=document.createElement('button'); btn.textContent='삭제'; btn.className='text-red-500'; btn.onclick=()=>row.remove(); td.appendChild(btn); row.appendChild(td);
      document.getElementById('log-body').appendChild(row);
    };

    document.getElementById('btn-clear').onclick = ()=>{
      document.getElementById('log-body').innerHTML='';
    };

    document.getElementById('btn-graph').onclick = ()=>{
      const rows=document.querySelectorAll('#log-body tr');
      if(!rows.length) return alert('저장된 기록이 없습니다.');
      const labels=[],caArr=[],mgArr=[],khArr=[];
      rows.forEach(r=>{const c=r.children; labels.push(c[0].textContent); caArr.push(+c[4].textContent); mgArr.push(+c[5].textContent); khArr.push(+c[6].textContent);});
      const w=window.open('','Graph','width=900,height=500');
      w.document.write('<!DOCTYPE html><html><head><meta charset="UTF-8"><script src="https://cdn.jsdelivr.net/npm/chart.js"></script></head><body><canvas id="chart"></canvas><script>const ctx=document.getElementById("chart").getContext("2d");new Chart(ctx,{type:"line",data:{labels:'+JSON.stringify(labels)+',datasets:[{label:"Ca",data:'+JSON.stringify(caArr)+',borderColor:"#60A5FA",fill:false},{label:"Mg",data:'+JSON.stringify(mgArr)+',borderColor:"#34D399",fill:false},{label:"KH",data:'+JSON.stringify(khArr)+',borderColor:"#FBBF24",fill:false}]},options:{responsive:true}});<\/script></body></html>');
    };

    document.getElementById('btn-ai').onclick = ()=>{
      const ca=+document.getElementById('ca').value,mg=+document.getElementById('mg').value,kh=+document.getElementById('kh').value;
      let html='<h2>AI 어드바이스</h2><ul>';
      if(ca<415) html+='<li>칼슘(Ca) 수치 낮음: 도징 시작</li>';
      if(mg<1400) html+='<li>마그네슘(Mg) 수치 낮음: 보충 필요</li>';
      if(kh<7.7) html+='<li>KH 수치 낮음: 알카리니티 도징 권장</li>';
      if(html=='<h2>AI 어드바이스</h2><ul>') html+='<li>모든 수치 안정</li>';
      html+='</ul>';
      const w=window.open('','AI','width=600,height=400'); w.document.write('<!DOCTYPE html><html><head><meta charset="UTF-8"></head><body>'+html+'</body></html>');
    };
  </script>
</body>
</html>
