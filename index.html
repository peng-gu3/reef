<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•´ìˆ˜í•­ ê´€ë¦¬ì¼ì§€</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React ë° ReactDOM ë¡œë“œ -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel ë¡œë“œ (JSX ë³€í™˜ìš©) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Recharts ì˜ì¡´ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ (Prop-Types) ë¡œë“œ -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <!-- Recharts (ê·¸ë˜í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬) ë¡œë“œ -->
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.12.7/umd/Recharts.min.js"></script>
    <style>
        body {
            background-color: #1a202c; /* bg-gray-900 */
        }
        .recharts-legend-item {
            cursor: pointer;
        }
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ ìŠ¤íƒ€ì¼ */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const originalError = console.error;
        console.error = (...args) => {
          if (typeof args[0] === 'string' && /defaultProps/.test(args[0])) return;
          originalError(...args);
        };

        const { useState, useEffect } = React;

        const TARGET_RANGES = {
          temp: { min: 25.5, max: 26.5, unit: 'Â°C' },
          salinity: { min: 34.0, max: 35.0, unit: 'ppt' },
          ph: { min: 8.0, max: 8.4, unit: '' },
          kh: { min: 7.3, max: 8.0, unit: 'dKH' },
          calcium: { min: 400, max: 430, unit: 'ppm' },
          magnesium: { min: 1350, max: 1440, unit: 'ppm' },
          nitrate: { min: 0.5, max: 2.0, unit: 'ppm' },
          phosphate: { min: 0.03, max: 0.07, unit: 'ppm' },
        };
        
        const chartLines = [
            { dataKey: 'temp', name: 'ì˜¨ë„ (Â°C)', color: '#FF69B4', yAxisId: 'left' },
            { dataKey: 'salinity', name: 'ì—¼ë„ (ppt)', color: '#00BFFF', yAxisId: 'left' },
            { dataKey: 'ph', name: 'pH', color: '#DA70D6', yAxisId: 'left' },
            { dataKey: 'kh', name: 'KH (dKH)', color: '#4169E1', yAxisId: 'left' },
            { dataKey: 'nitrite', name: 'ì•„ì§ˆì‚° (ppm)', color: '#DC143C', yAxisId: 'left' },
            { dataKey: 'nitrate', name: 'ì§ˆì‚°ì—¼ (ppm)', color: '#FF4500', yAxisId: 'left' },
            { dataKey: 'phosphate', name: 'ì¸ì‚°ì—¼ (ppm)', color: '#32CD32', yAxisId: 'left' },
            { dataKey: 'calcium', name: 'ì¹¼ìŠ˜ (ppm)', color: '#3CB371', yAxisId: 'right' },
            { dataKey: 'magnesium', name: 'ë§ˆê·¸ë„¤ìŠ˜ (ppm)', color: '#FFD700', yAxisId: 'right' },
        ];

        const calculateDosing = (log, waterVolume) => {
          const dosing = {};
          if (!log || typeof waterVolume !== 'number' || waterVolume <= 0) return dosing;
          if (log.kh < TARGET_RANGES.kh.min) { dosing.kh = ((waterVolume * (TARGET_RANGES.kh.min - log.kh)) / 10).toFixed(2); }
          if (log.calcium < TARGET_RANGES.calcium.min) { dosing.calcium = ((waterVolume * (TARGET_RANGES.calcium.min - log.calcium)) / 200).toFixed(2); }
          if (log.magnesium < TARGET_RANGES.magnesium.min) { dosing.magnesium = ((waterVolume * (TARGET_RANGES.magnesium.min - log.magnesium)) / 100).toFixed(2); }
          if (log.nitrate < TARGET_RANGES.nitrate.min) { dosing.nitrate = ((waterVolume * (TARGET_RANGES.nitrate.min - log.nitrate)) / 100).toFixed(2); }
          if (log.phosphate < TARGET_RANGES.phosphate.min) { dosing.phosphate = ((waterVolume * (TARGET_RANGES.phosphate.min - log.phosphate)) / 10).toFixed(2); }
          return dosing;
        };


        const App = () => {
          const [waterVolume, setWaterVolume] = useState(() => {
            const savedVolume = localStorage.getItem('waterVolume');
            return savedVolume ? parseInt(savedVolume, 10) : 200;
          });
          const [isEditingVolume, setIsEditingVolume] = useState(false);
          const [tempVolume, setTempVolume] = useState(waterVolume);
          
          const [logs, setLogs] = useState([]);
          const [dosingStatus, setDosingStatus] = useState({});
          const [hiddenLines, setHiddenLines] = useState({});
          const [viewMode, setViewMode] = useState('latest');
          const [analysisResult, setAnalysisResult] = useState(null);
          const [isLoadingAnalysis, setIsLoadingAnalysis] = useState(false);

          const [newLog, setNewLog] = useState({
            date: new Date().toISOString().slice(0, 10),
            temp: '', salinity: '', ph: '', kh: '',
            calcium: '', magnesium: '', nitrite: '0', nitrate: '', phosphate: '',
            notes: ''
          });

          useEffect(() => {
            localStorage.setItem('waterVolume', waterVolume);
          }, [waterVolume]);

          useEffect(() => {
            const initialLogs = [
                { id: 1, date: '2025-07-30', temp: 26.0, salinity: 35.0, ph: 8.1, kh: 7.0, calcium: 380, magnesium: 1300, nitrite: 0, nitrate: 2.0, phosphate: 0.05, notes: 'ì´ˆê¸° ë°ì´í„°' },
                { id: 2, date: '2025-08-01', temp: 25.8, salinity: 34.5, ph: 8.2, kh: 7.5, calcium: 410, magnesium: 1350, nitrite: 0, nitrate: 1.5, phosphate: 0.04, notes: 'í™˜ìˆ˜ í›„ ì•ˆì •' },
                { id: 3, date: '2025-08-02', temp: 25.9, salinity: 34.6, ph: 8.3, kh: 7.8, calcium: 420, magnesium: 1380, nitrite: 0, nitrate: 1.0, phosphate: 0.03, notes: 'ìˆ˜ì§ˆ ì•ˆì •' }
            ].sort((a, b) => new Date(b.date) - new Date(a.date));
            setLogs(initialLogs);
          }, []);

          const createAnalysisPrompt = (log) => {
            return `ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ í•´ìˆ˜ì–´í•­ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ëŠ” ì˜¤ëŠ˜ ì¸¡ì •í•œ ì €ì˜ í•´ìˆ˜ì–´í•­ ìˆ˜ì§ˆ ë°ì´í„°ì…ë‹ˆë‹¤.

- ë‚ ì§œ: ${log.date}
- ì˜¨ë„: ${log.temp}Â°C (ëª©í‘œ: ${TARGET_RANGES.temp.min}-${TARGET_RANGES.temp.max}Â°C)
- ì—¼ë„: ${log.salinity}ppt (ëª©í‘œ: ${TARGET_RANGES.salinity.min}-${TARGET_RANGES.salinity.max}ppt)
- pH: ${log.ph} (ëª©í‘œ: ${TARGET_RANGES.ph.min}-${TARGET_RANGES.ph.max})
- KH: ${log.kh}dKH (ëª©í‘œ: ${TARGET_RANGES.kh.min}-${TARGET_RANGES.kh.max}dKH)
- ì¹¼ìŠ˜: ${log.calcium}ppm (ëª©í‘œ: ${TARGET_RANGES.calcium.min}-${TARGET_RANGES.calcium.max}ppm)
- ë§ˆê·¸ë„¤ìŠ˜: ${log.magnesium}ppm (ëª©í‘œ: ${TARGET_RANGES.magnesium.min}-${TARGET_RANGES.magnesium.max}ppm)
- ì§ˆì‚°ì—¼: ${log.nitrate}ppm (ëª©í‘œ: ${TARGET_RANGES.nitrate.min}-${TARGET_RANGES.nitrate.max}ppm)
- ì¸ì‚°ì—¼: ${log.phosphate}ppm (ëª©í‘œ: ${TARGET_RANGES.phosphate.min}-${TARGET_RANGES.phosphate.max}ppm)
- íŠ¹ì´ì‚¬í•­: ${log.notes || 'ì—†ìŒ'}

ì´ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ë‹¤ìŒ í•­ëª©ì— ëŒ€í•´ ì „ë¬¸ê°€ì˜ ì…ì¥ì—ì„œ ì¹œì ˆí•˜ê³  ìƒì„¸í•˜ê²Œ ë¶„ì„í•˜ê³  ì¡°ì–¸í•´ì£¼ì„¸ìš”:

1.  **ì¢…í•© í‰ê°€:** í˜„ì¬ ì–´í•­ ìƒíƒœì— ëŒ€í•œ ì „ë°˜ì ì¸ í‰ê°€ë¥¼ í•œë‘ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”.
2.  **ê¸ì •ì ì¸ ì :** ëª©í‘œ ë²”ìœ„ ë‚´ì— ìˆì–´ ì˜ ê´€ë¦¬ë˜ê³  ìˆëŠ” í•­ëª©ë“¤ì„ ì¹­ì°¬í•´ì£¼ì„¸ìš”.
3.  **ì£¼ì˜ ë° ê°œì„  í•„ìš” í•­ëª©:** ëª©í‘œ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ê±°ë‚˜ ì£¼ì˜ê°€ í•„ìš”í•œ í•­ëª©ì„ ì§€ì í•˜ê³ , ê·¸ ì›ì¸ê³¼ í•´ê²°ì„ ìœ„í•œ êµ¬ì²´ì ì¸ ì¡°ì¹˜ë¥¼ ì œì•ˆí•´ì£¼ì„¸ìš”. ë„ì§•ì´ í•„ìš”í•˜ë‹¤ë©´ ì–´ë–¤ ê²ƒì„ í•´ì•¼ í•˜ëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”.
4.  **ë‹¤ìŒ ê´€ë¦¬ íŒ:** ì•ìœ¼ë¡œ ì–´í•­ì„ ë” ì˜ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì¶”ê°€ì ì¸ íŒì´ë‚˜ ì œì•ˆì„ í•´ì£¼ì„¸ìš”.

ê²°ê³¼ëŠ” ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•´ì„œ ë³´ì—¬ì£¼ì„¸ìš”.`;
          };

          const handleAnalysis = async (log) => {
            setIsLoadingAnalysis(true);
            setAnalysisResult({ logDate: log.date, text: "" });

            const prompt = createAnalysisPrompt(log);
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) throw new Error(`API ìš”ì²­ ì‹¤íŒ¨: ${response.status}`);
                
                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;
                setAnalysisResult({ logDate: log.date, text: text });
            } catch (error) {
                console.error("Gemini API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                setAnalysisResult({ logDate: log.date, text: "AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." });
            } finally {
                setIsLoadingAnalysis(false);
            }
          };

          const handleInputChange = (e) => {
            const { name, value } = e.target;
            setNewLog({ ...newLog, [name]: value });
          };

          const handleAddLog = (e) => {
            e.preventDefault();
            const requiredFields = ['date', 'temp', 'salinity', 'ph', 'kh', 'calcium', 'magnesium', 'nitrite', 'nitrate', 'phosphate'];
            if (requiredFields.some(field => !newLog[field])) {
              alert('ëª¨ë“  ìˆ˜ì§ˆ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              return;
            }
            
            const logToAdd = { id: Date.now(), ...newLog };
            for (const key in logToAdd) {
                if(key !== 'date' && key !== 'notes' && key !== 'id') {
                    logToAdd[key] = parseFloat(logToAdd[key]);
                }
            }

            setLogs([...logs, logToAdd].sort((a, b) => new Date(b.date) - new Date(a.date)));
            setNewLog({
                date: new Date().toISOString().slice(0, 10), temp: '', salinity: '', ph: '', kh: '',
                calcium: '', magnesium: '', nitrite: '0', nitrate: '', phosphate: '', notes: ''
            });
          };

          const handleDeleteLog = (idToDelete) => {
            if (window.confirm('ì •ë§ë¡œ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                setLogs(logs.filter(log => log.id !== idToDelete));
            }
          };
          
          const toggleDosingStatus = (logId, param) => {
            setDosingStatus(prev => ({ ...prev, [`${logId}-${param}`]: !prev[`${logId}-${param}`] }));
          };

          const handleLegendClick = (e) => {
            const { dataKey } = e;
            setHiddenLines(prev => ({ ...prev, [dataKey]: !prev[dataKey] }));
          };

          const handleSaveVolume = () => {
            setWaterVolume(tempVolume);
            setIsEditingVolume(false);
          };

          const getFilteredLogs = () => {
            const today = new Date();
            const todayStr = today.toISOString().slice(0, 10);
            
            switch (viewMode) {
                case 'latest': return logs.length > 0 ? [logs[0]] : [];
                case 'today': return logs.filter(log => log.date === todayStr);
                case 'last7days':
                    const sevenDaysAgo = new Date();
                    sevenDaysAgo.setDate(today.getDate() - 7);
                    return logs.filter(log => new Date(log.date) >= sevenDaysAgo);
                default: return logs;
            }
          };
          const filteredLogs = getFilteredLogs();
          
          const renderColorfulLegendText = (value, entry) => {
            const { color } = entry;
            const style = {
                color: color,
                fontSize: '14px',
                fontWeight: 500
            };
            return <span style={style}>{value}</span>;
          };


          const renderChart = () => {
            if (!window.Recharts) {
              return <div className="flex items-center justify-center h-full text-yellow-400">ê·¸ë˜í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì¤‘...</div>;
            }
            const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts;
            const chartData = [...logs].sort((a, b) => new Date(a.date) - new Date(b.date));
            return (
              <ResponsiveContainer width="100%" height={400}>
                <LineChart data={chartData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#4A5568" />
                    <XAxis dataKey="date" stroke="#A0AEC0" />
                    <YAxis yAxisId="left" stroke="#A0AEC0" domain={['dataMin - 1', 'dataMax + 1']} />
                    <YAxis yAxisId="right" orientation="right" stroke="#A0AEC0" domain={['dataMin - 50', 'dataMax + 50']} />
                    <Tooltip contentStyle={{ backgroundColor: '#1A202C', border: '1px solid #4A5568' }} />
                    <Legend onClick={handleLegendClick} formatter={renderColorfulLegendText} />
                    {chartLines.map(line => !hiddenLines[line.dataKey] && <Line key={line.dataKey} {...line} />)}
                </LineChart>
              </ResponsiveContainer>
            );
          };

          return (
            <div className="bg-gray-900 text-white min-h-screen font-sans p-4 md:p-8">
              <div className="container mx-auto max-w-7xl">
                
                <header className="text-center mb-8">
                  <h1 className="text-4xl font-bold text-cyan-400">í•´ìˆ˜í•­ ê´€ë¦¬ì¼ì§€</h1>
                </header>

                <div className="bg-gray-800 p-4 rounded-xl mb-8 flex items-center space-x-4">
                  <label className="font-bold text-lg">ìˆ˜ì¡° ì´ ë¬¼ëŸ‰ (L):</label>
                  {isEditingVolume ? (
                    <>
                      <input 
                        type="number"
                        value={tempVolume}
                        onChange={(e) => setTempVolume(parseInt(e.target.value, 10) || 0)}
                        className="bg-gray-700 w-32 p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500"
                      />
                      <button onClick={handleSaveVolume} className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">ì €ì¥</button>
                    </>
                  ) : (
                    <>
                      <span className="text-lg font-semibold text-cyan-400">{waterVolume} L</span>
                      <button onClick={() => setIsEditingVolume(true)} className="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">ìˆ˜ì •</button>
                    </>
                  )}
                </div>

                <div className="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8 h-[450px]">
                    <h2 className="text-2xl font-semibold mb-4 text-center">ìˆ˜ì§ˆ ë³€í™” ê·¸ë˜í”„</h2>
                    {renderChart()}
                </div>

                <div className="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8">
                  <h2 className="text-2xl font-semibold mb-4">ìƒˆ ì¼ì§€ ì‘ì„±</h2>
                  <form onSubmit={handleAddLog} className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
                    <input type="date" name="date" value={newLog.date} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="number" step="0.1" name="temp" placeholder={`ì˜¨ë„ (Â°C)`} value={newLog.temp} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="number" step="0.1" name="salinity" placeholder={`ì—¼ë„ (ppt)`} value={newLog.salinity} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="number" step="0.1" name="ph" placeholder={`pH`} value={newLog.ph} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="number" step="0.1" name="kh" placeholder={`KH (dKH)`} value={newLog.kh} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="number" name="calcium" placeholder={`ì¹¼ìŠ˜ (ppm)`} value={newLog.calcium} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="number" name="magnesium" placeholder={`ë§ˆê·¸ë„¤ìŠ˜ (ppm)`} value={newLog.magnesium} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="number" step="0.01" name="nitrite" placeholder={`ì•„ì§ˆì‚° (ppm)`} value={newLog.nitrite} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="number" step="0.01" name="nitrate" placeholder={`ì§ˆì‚°ì—¼ (ppm)`} value={newLog.nitrate} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="number" step="0.01" name="phosphate" placeholder={`ì¸ì‚°ì—¼ (ppm)`} value={newLog.phosphate} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" />
                    <input type="text" name="notes" placeholder="íŠ¹ì´ì‚¬í•­" value={newLog.notes} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg col-span-2 lg:col-span-4" />
                    <button type="submit" className="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 col-span-2 lg:col-span-1">ì¼ì§€ ì¶”ê°€</button>
                  </form>
                </div>

                <main>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-2xl font-semibold">ì „ì²´ ê¸°ë¡</h2>
                    <div className="flex space-x-2">
                      <button onClick={() => setViewMode('latest')} className={`px-3 py-1 text-sm rounded-md ${viewMode === 'latest' ? 'bg-cyan-500' : 'bg-gray-600 hover:bg-gray-500'}`}>ìµœê·¼ 1ê°œ</button>
                      <button onClick={() => setViewMode('today')} className={`px-3 py-1 text-sm rounded-md ${viewMode === 'today' ? 'bg-cyan-500' : 'bg-gray-600 hover:bg-gray-500'}`}>ì˜¤ëŠ˜</button>
                      <button onClick={() => setViewMode('last7days')} className={`px-3 py-1 text-sm rounded-md ${viewMode === 'last7days' ? 'bg-cyan-500' : 'bg-gray-600 hover:bg-gray-500'}`}>ìµœê·¼ 7ì¼</button>
                    </div>
                  </div>

                  <div className="space-y-4">
                    {filteredLogs.length > 0 ? filteredLogs.map(log => {
                      const dosings = calculateDosing(log, waterVolume);
                      const isOutOfRange = (param) => log[param] < TARGET_RANGES[param].min || log[param] > TARGET_RANGES[param].max;
                      const bacterDosed = dosingStatus[`${log.id}-bacter`];
                      return (
                        <div key={log.id} className="bg-gray-800 p-4 rounded-lg border border-gray-700">
                          <div className="flex justify-between items-start mb-3">
                            <p className="font-bold text-lg text-cyan-400">{log.date}</p>
                            <div>
                                <button onClick={() => handleAnalysis(log)} className="bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1 px-2 rounded-lg mr-2">âœ¨ AI ë¶„ì„ ë° ì¡°ì–¸</button>
                                <button onClick={() => handleDeleteLog(log.id)} className="bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded-lg">ì‚­ì œ</button>
                            </div>
                          </div>
                          <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-x-4 gap-y-2 text-sm mb-4">
                              <p className={`flex items-center ${isOutOfRange('temp') ? 'text-red-400' : 'text-gray-300'}`}>ğŸŒ¡ï¸<span className="ml-2">ì˜¨ë„: {log.temp} Â°C</span></p>
                              <p className={`flex items-center ${isOutOfRange('salinity') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ’§<span className="ml-2">ì—¼ë„: {log.salinity} ppt</span></p>
                              <p className={`flex items-center ${isOutOfRange('ph') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ§ª<span className="ml-2">pH: {log.ph}</span></p>
                              <p className={`flex items-center ${isOutOfRange('kh') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ’<span className="ml-2">KH: {log.kh} dKH</span></p>
                              <p className={`flex items-center ${isOutOfRange('calcium') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ¦´<span className="ml-2">ì¹¼ìŠ˜: {log.calcium} ppm</span></p>
                              <p className={`flex items-center ${isOutOfRange('magnesium') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ”©<span className="ml-2">ë§ˆê·¸ë„¤ìŠ˜: {log.magnesium} ppm</span></p>
                              <p className={`flex items-center ${log.nitrite > 0 ? 'text-red-400' : 'text-gray-300'}`}>ğŸš«<span className="ml-2">ì•„ì§ˆì‚°: {log.nitrite} ppm</span></p>
                              <p className={`flex items-center ${isOutOfRange('nitrate') ? 'text-red-400' : 'text-gray-300'}`}>ğŸŒ¿<span className="ml-2">ì§ˆì‚°ì—¼: {log.nitrate} ppm</span></p>
                              <p className={`flex items-center ${isOutOfRange('phosphate') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ¦ <span className="ml-2">ì¸ì‚°ì—¼: {log.phosphate} ppm</span></p>
                          </div>
                          <div className="border-t border-gray-700 pt-3">
                              <h4 className="font-semibold text-md mb-2">ë„ì§• ê´€ë¦¬</h4>
                              <div className="flex flex-wrap gap-4">
                                  {Object.keys(dosings).map(param => (
                                      <div key={param}><button onClick={() => toggleDosingStatus(log.id, param)} className={`py-1 px-3 rounded-lg text-xs font-bold ${dosingStatus[`${log.id}-${param}`] ? 'bg-green-600' : 'bg-yellow-500 hover:bg-yellow-600'}`}>{param.toUpperCase()}: {dosings[param]}ml {dosingStatus[`${log.id}-${param}`] ? 'âœ”ï¸ ë„ì§• ì™„ë£Œ' : 'â“ ë„ì§• ì˜ˆì •'}</button></div>
                                  ))}
                                  {Object.keys(dosings).length === 0 && <p className="text-sm text-gray-400">ëª¨ë“  ìˆ˜ì¹˜ê°€ ì•ˆì •ì ì…ë‹ˆë‹¤. (ë„ì§• í•„ìš” ì—†ìŒ)</p>}
                                  <button onClick={() => toggleDosingStatus(log.id, 'bacter')} className={`py-1 px-3 rounded-lg text-xs font-bold ${dosingStatus[`${log.id}-bacter`] ? 'bg-green-600' : 'bg-purple-600 hover:bg-purple-700'}`}>{dosingStatus[`${log.id}-bacter`] ? 'âœ”ï¸ ë°•í„°ì˜¤ë¦¬ì§„ ë„ì§•ì™„ë£Œ' : 'ë°•í„°ì˜¤ë¦¬ì§„ ë„ì§•'}</button>
                              </div>
                          </div>
                          {log.notes && <p className="mt-3 text-gray-300 text-sm"><span className="font-semibold">ğŸ“ íŠ¹ì´ì‚¬í•­:</span> {log.notes}</p>}
                        </div>
                      )
                    }) : <div className="text-center text-gray-500 py-8">í•´ë‹¹ ê¸°ê°„ì˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>}
                  </div>
                </main>

                {/* AI ë¶„ì„ ê²°ê³¼ í‘œì‹œ ì˜ì—­ */}
                {(isLoadingAnalysis || analysisResult) && (
                    <div className="fixed bottom-0 right-0 m-8 w-full max-w-md bg-gray-800 border-2 border-blue-500 rounded-xl shadow-2xl z-50">
                        <div className="p-4 border-b border-gray-700">
                            <h3 className="text-lg font-bold text-blue-400">
                                {analysisResult ? `${analysisResult.logDate} ê¸°ë¡ì— ëŒ€í•œ AI ë¶„ì„` : "AI ë¶„ì„"}
                            </h3>
                        </div>
                        <div className="p-4 h-80 overflow-y-auto">
                            {isLoadingAnalysis ? (
                                <div className="flex items-center justify-center h-full">
                                    <div className="loader"></div>
                                    <p className="ml-4">Gemini AIê°€ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
                                </div>
                            ) : (
                                <pre className="text-sm text-gray-300 whitespace-pre-wrap font-sans">{analysisResult.text}</pre>
                            )}
                        </div>
                         <div className="p-2 border-t border-gray-700 text-right">
                            <button onClick={() => setAnalysisResult(null)} className="text-xs text-gray-400 hover:text-white">ë‹«ê¸°</button>
                        </div>
                    </div>
                )}

              </div>
            </div>
          );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
