<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간편 재고 관리 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .table-auto th, .table-auto td {
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
        }
        .table-auto thead th {
            background-color: #f8fafc;
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-container {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app" class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8 relative">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">간편 재고 관리 시스템 (오프라인)</h1>
            <p class="text-gray-600 mt-2">모든 데이터는 현재 브라우저에만 저장됩니다.</p>
            <button id="reset-data-btn" class="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold py-1 px-3 rounded-full hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150">
                전체 초기화
            </button>
        </header>

        <div id="main-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Input Forms Section -->
                <div class="lg:col-span-1 flex flex-col gap-8">
                    <!-- Production Form -->
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-blue-600">생산 등록</h2>
                        <form id="production-form" class="space-y-4">
                            <div>
                                <label for="prod-item" class="block text-sm font-medium text-gray-700">ITEM NO.</label>
                                <input type="text" id="prod-item" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="예: ALS910C" required>
                            </div>
                            <div>
                                <label for="prod-size" class="block text-sm font-medium text-gray-700">SIZE</label>
                                <input type="text" id="prod-size" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="예: 1/8&quot;" required>
                            </div>
                            <div>
                                <label for="prod-lot" class="block text-sm font-medium text-gray-700">시작 LOT NO.</label>
                                <input type="text" id="prod-lot" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="예: 2501C321" required>
                            </div>
                             <div>
                                <label for="prod-raw-lot" class="block text-sm font-medium text-gray-700">원자재 LOT</label>
                                <input type="text" id="prod-raw-lot" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="예: YC-TX220303">
                            </div>
                            <div>
                                <label for="prod-quantity" class="block text-sm font-medium text-gray-700">총 수량 (LB)</label>
                                <input type="number" id="prod-quantity" min="0.1" step="0.1" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                            </div>
                            <div>
                                <label for="prod-unit-quantity" class="block text-sm font-medium text-gray-700">단위당 수량 (LB)</label>
                                <input type="number" id="prod-unit-quantity" value="10" min="0.1" step="0.1" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                            </div>
                            <div>
                                <label for="prod-weight" class="block text-sm font-medium text-gray-700">총 무게 (g)</label>
                                <input type="number" id="prod-weight" min="0" step="0.1" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="예: 5200">
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150">생산 추가</button>
                        </form>
                    </div>

                    <!-- Shipping Form -->
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-red-600">출고 등록</h2>
                        <form id="shipping-form" class="space-y-4">
                            <div>
                                <label for="ship-item" class="block text-sm font-medium text-gray-700">ITEM NO.</label>
                                 <input type="text" id="ship-item" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="예: ALS910C" required>
                            </div>
                            <div>
                                <label for="ship-size" class="block text-sm font-medium text-gray-700">SIZE</label>
                                <input type="text" id="ship-size" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="예: 1/8&quot;" required>
                            </div>
                             <div>
                                <label for="ship-client" class="block text-sm font-medium text-gray-700">납품처</label>
                                <input type="text" id="ship-client" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="예: DFR">
                            </div>
                            <div>
                                <label for="ship-lot" class="block text-sm font-medium text-gray-700">LOT NO.</label>
                                <input type="text" id="ship-lot" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-red-500 focus:border-red-500" placeholder="출고되는 제품 Lot No." required>
                            </div>
                            <div>
                                <label for="ship-quantity" class="block text-sm font-medium text-gray-700">수량 (LB)</label>
                                <input type="number" id="ship-quantity" min="0.1" step="0.1" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-red-500 focus:border-red-500" required>
                            </div>
                            <button type="submit" class="w-full bg-red-600 text-white font-bold py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150">출고 처리</button>
                        </form>
                    </div>
                </div>

                <!-- Inventory List Section -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                    <div class="flex justify-between items-center mb-4">
                         <h2 class="text-xl font-semibold">완제품 재고 현황</h2>
                         <div class="flex gap-2">
                             <input type="text" id="filter-inventory-item" placeholder="ITEM NO. 필터" class="border border-gray-300 rounded-md shadow-sm py-1 px-2 text-sm">
                             <input type="text" id="filter-inventory-size" placeholder="SIZE 필터" class="border border-gray-300 rounded-md shadow-sm py-1 px-2 text-sm">
                         </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table id="inventory-table" class="w-full table-auto text-sm text-left">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-3">ITEM NO.</th>
                                    <th class="p-3">SIZE</th>
                                    <th class="p-3 text-right">현재고 (LB)</th>
                                    <th class="p-3">최근 LOT NO.</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Logs Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">생산 기록</h3>
                        <input type="text" id="filter-production-log" placeholder="기록 검색..." class="border border-gray-300 rounded-md shadow-sm py-1 px-2 text-sm">
                    </div>
                    <div class="overflow-y-auto h-64">
                        <table class="w-full text-sm">
                            <thead class="sticky top-0 bg-white">
                                <tr>
                                    <th>일시</th>
                                    <th>ITEM</th>
                                    <th>SIZE</th>
                                    <th>수량(LB)</th>
                                    <th>무게(g)</th>
                                    <th>LOT NO.</th>
                                    <th>원자재 LOT</th>
                                </tr>
                            </thead>
                            <tbody id="production-log"></tbody>
                        </table>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">출고 기록</h3>
                        <input type="text" id="filter-shipping-log" placeholder="기록 검색..." class="border border-gray-300 rounded-md shadow-sm py-1 px-2 text-sm">
                    </div>
                    <div class="overflow-y-auto h-64">
                        <table class="w-full text-sm">
                            <thead class="sticky top-0 bg-white">
                                <tr>
                                    <th>일시</th>
                                    <th>ITEM</th>
                                    <th>SIZE</th>
                                    <th>납품처</th>
                                    <th>수량(LB)</th>
                                    <th>LOT NO.</th>
                                </tr>
                            </thead>
                            <tbody id="shipping-log"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for notifications -->
    <div id="modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0">
        <div class="modal-container bg-white w-full max-w-sm rounded-lg shadow-xl p-6 text-center transform scale-95">
            <p id="modal-message" class="text-lg"></p>
            <div class="mt-6 space-x-4">
                <button id="modal-confirm" class="bg-red-600 text-white font-bold py-2 px-6 rounded-md hover:bg-red-700 transition duration-150 hidden">확인</button>
                <button id="modal-close" class="bg-gray-800 text-white font-bold py-2 px-6 rounded-md hover:bg-gray-900 transition duration-150">닫기</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resetButton = document.getElementById('reset-data-btn');
            const inventoryBodyEl = document.getElementById('inventory-body');
            const productionForm = document.getElementById('production-form');
            const shippingForm = document.getElementById('shipping-form');
            const productionLogEl = document.getElementById('production-log');
            const shippingLogEl = document.getElementById('shipping-log');
            const modal = document.getElementById('modal');
            const modalMessage = document.getElementById('modal-message');
            const modalClose = document.getElementById('modal-close');
            const modalConfirm = document.getElementById('modal-confirm');
            
            const filterInventoryItemInput = document.getElementById('filter-inventory-item');
            const filterInventorySizeInput = document.getElementById('filter-inventory-size');
            const filterProductionLogInput = document.getElementById('filter-production-log');
            const filterShippingLogInput = document.getElementById('filter-shipping-log');

            let confirmCallback = null;
            let state = {
                inventory: {},
                productionLog: [],
                shippingLog: [],
            };

            const DB_KEY = 'simpleInventoryDB';

            function loadState() {
                const savedState = localStorage.getItem(DB_KEY);
                if (savedState) {
                    state = JSON.parse(savedState);
                } else {
                    populateInitialData();
                }
            }

            function saveState() {
                localStorage.setItem(DB_KEY, JSON.stringify(state));
            }
            
            function populateInitialData() {
                const itemNos = ["ALS910C", "ALS900G", "ALS955W", "ALS970", "ALS990", "ALS420", "ALS610", "ALS620", "ALS623S", "ALS630N", "ALS640K", "ALS350Y"];
                const sizes = ["1/8\"", "3/16\"", "1/4\"", "5/16\"", "3/8\"", "7/16\"", "1/2\"", "9/16\"", "5/8\"", "11/16\"", "3/4\"", "13/16\"", "7/8\"", "1\"", "1-1/8\"", "1-1/4\""];
                
                state.inventory = {};
                itemNos.forEach(itemNo => {
                    state.inventory[itemNo] = {};
                    sizes.forEach(size => {
                        state.inventory[itemNo][size] = { quantity: 0, lot: '' };
                    });
                });
                
                state.productionLog = [];
                state.shippingLog = [];
                saveState();
            }

            function showModal(message, showConfirm = false, callback = null) {
                modalMessage.textContent = message;
                modalConfirm.classList.toggle('hidden', !showConfirm);
                modalClose.textContent = showConfirm ? '취소' : '닫기';
                confirmCallback = showConfirm ? callback : null;
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 10);
            }

            function hideModal() {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
            
            modalClose.addEventListener('click', hideModal);
            modalConfirm.addEventListener('click', () => {
                if (confirmCallback) confirmCallback();
                hideModal();
            });

            function applyFiltersAndRender() {
                const inventoryItemFilter = filterInventoryItemInput.value.trim().toUpperCase();
                const inventorySizeFilter = filterInventorySizeInput.value.trim().toUpperCase();
                const productionFilter = filterProductionLogInput.value.trim().toUpperCase();
                const shippingFilter = filterShippingLogInput.value.trim().toUpperCase();

                renderInventory(inventoryItemFilter, inventorySizeFilter);
                renderLogs(productionFilter, shippingFilter);
            }

            function renderInventory(itemFilter = '', sizeFilter = '') {
                inventoryBodyEl.innerHTML = '';
                const inventory = state.inventory;

                if (!inventory || Object.keys(inventory).length === 0) {
                     inventoryBodyEl.innerHTML = `<tr><td colspan="4" class="text-center p-5">재고 데이터가 없습니다.</td></tr>`;
                     return;
                }
                
                let sortedItems = Object.keys(inventory).sort();

                if(itemFilter) {
                    sortedItems = sortedItems.filter(itemNo => itemNo.toUpperCase().includes(itemFilter));
                }
                
                let hasStock = false;
                
                for (const itemNo of sortedItems) {
                    const sizes = inventory[itemNo];
                    if (!sizes) continue;
                    
                    let sortedSizes = Object.keys(sizes).sort((a, b) => {
                        try {
                            const toNum = str => {
                                if (!str.includes('/') && !str.includes('-')) return parseFloat(str) || 0;
                                return str.split(/[\s-]+/).reduce((acc, part) => {
                                    const fractions = part.split('/');
                                    return acc + (parseFloat(fractions[0]) / (parseFloat(fractions[1]) || 1));
                                }, 0);
                            };
                            return toNum(a) - toNum(b);
                        } catch (e) { return a.localeCompare(b); }
                    });

                    if(sizeFilter) {
                        sortedSizes = sortedSizes.filter(size => size.toUpperCase().includes(sizeFilter));
                    }

                    for (const size of sortedSizes) {
                        const data = sizes[size];
                        if (data && data.quantity > 0) {
                            hasStock = true;
                            const row = document.createElement('tr');
                            row.className = 'hover:bg-gray-50';
                            row.innerHTML = `
                                <td class="font-medium">${itemNo}</td>
                                <td>${size}</td>
                                <td class="text-right">${(data.quantity || 0).toFixed(1)}</td>
                                <td>${data.lot || ''}</td>
                            `;
                            inventoryBodyEl.appendChild(row);
                        }
                    }
                }
                if (!hasStock) {
                    inventoryBodyEl.innerHTML = `<tr><td colspan="4" class="text-center p-5">일치하는 재고가 없습니다.</td></tr>`;
                }
            }
            
            function renderLogs(productionFilter = '', shippingFilter = '') {
                // Production Log
                productionLogEl.innerHTML = '';
                let filteredProductionLogs = state.productionLog;
                if(productionFilter) {
                    filteredProductionLogs = state.productionLog.filter(log => 
                        log.itemNo.toUpperCase().includes(productionFilter) ||
                        log.size.toUpperCase().includes(productionFilter) ||
                        log.lot.toUpperCase().includes(productionFilter) ||
                        (log.rawMaterialLot && log.rawMaterialLot.toUpperCase().includes(productionFilter))
                    );
                }

                filteredProductionLogs.slice().reverse().forEach(log => {
                    const row = document.createElement('tr');
                    row.className = 'border-b';
                    row.innerHTML = `<td class="p-2">${new Date(log.timestamp).toLocaleString('ko-KR')}</td><td class="p-2">${log.itemNo}</td><td class="p-2">${log.size}</td><td class="p-2">${log.quantity}</td><td class="p-2">${log.weightG || ''}</td><td class="p-2">${log.lot}</td><td class="p-2">${log.rawMaterialLot || ''}</td>`;
                    productionLogEl.appendChild(row);
                });

                // Shipping Log
                shippingLogEl.innerHTML = '';
                let filteredShippingLogs = state.shippingLog;
                if(shippingFilter) {
                    filteredShippingLogs = state.shippingLog.filter(log => 
                        log.itemNo.toUpperCase().includes(shippingFilter) ||
                        log.size.toUpperCase().includes(shippingFilter) ||
                        log.lot.toUpperCase().includes(shippingFilter) ||
                        (log.client && log.client.toUpperCase().includes(shippingFilter))
                    );
                }

                filteredShippingLogs.slice().reverse().forEach(log => {
                    const row = document.createElement('tr');
                    row.className = 'border-b';
                    row.innerHTML = `<td class="p-2">${new Date(log.timestamp).toLocaleString('ko-KR')}</td><td class="p-2">${log.itemNo}</td><td class="p-2">${log.size}</td><td class="p-2">${log.client || ''}</td><td class="p-2">${log.quantity}</td><td class="p-2">${log.lot}</td>`;
                    shippingLogEl.appendChild(row);
                });
            }

            function resetAllData() {
                showModal("데이터를 초기화하는 중...", false);
                populateInitialData();
                applyFiltersAndRender();
                showModal("모든 데이터가 성공적으로 초기화되었습니다.");
            }

            resetButton.addEventListener('click', () => showModal("정말 모든 데이터를 삭제하고 시스템을 초기화하시겠습니까?", true, resetAllData));

            productionForm.addEventListener('submit', e => {
                e.preventDefault();
                const itemNo = document.getElementById('prod-item').value.trim().toUpperCase();
                const size = document.getElementById('prod-size').value.trim();
                const startLot = document.getElementById('prod-lot').value.trim();
                const rawMaterialLot = document.getElementById('prod-raw-lot').value.trim();
                const totalQuantity = parseFloat(document.getElementById('prod-quantity').value);
                const unitQuantity = parseFloat(document.getElementById('prod-unit-quantity').value);
                const totalWeightG = parseFloat(document.getElementById('prod-weight').value);

                if (!itemNo || !size || !startLot || isNaN(totalQuantity) || totalQuantity <= 0 || isNaN(unitQuantity) || unitQuantity <= 0) {
                    return showModal('필수 항목(ITEM NO, SIZE, 시작 LOT, 총 수량, 단위 수량)을 모두 입력해주세요.');
                }

                const lotMatch = startLot.match(/(.*?)(\d+)$/);
                if (!lotMatch) {
                    return showModal('LOT 번호는 숫자로 끝나야 합니다. 예: 2505S1271');
                }

                const lotPrefix = lotMatch[1];
                const startNumber = parseInt(lotMatch[2], 10);
                
                const numberOfUnits = Math.ceil(totalQuantity / unitQuantity);
                const weightPerUnit = !isNaN(totalWeightG) ? (totalWeightG / numberOfUnits) : null;

                if (!state.inventory[itemNo]) state.inventory[itemNo] = {};
                if (!state.inventory[itemNo][size]) state.inventory[itemNo][size] = { quantity: 0, lot: '' };
                
                let lastLotNumber = '';

                for (let i = 0; i < numberOfUnits; i++) {
                    const remainingQuantity = totalQuantity - (i * unitQuantity);
                    const currentUnitQuantity = Math.min(unitQuantity, remainingQuantity);
                    
                    const currentLotNumber = lotPrefix + (startNumber + i);
                    lastLotNumber = currentLotNumber;
                    
                    state.productionLog.push({
                        itemNo,
                        size,
                        lot: currentLotNumber,
                        rawMaterialLot,
                        quantity: currentUnitQuantity,
                        weightG: weightPerUnit ? parseFloat(weightPerUnit.toFixed(1)) : '',
                        timestamp: new Date().toISOString()
                    });
                }
                
                state.inventory[itemNo][size].quantity += totalQuantity;
                state.inventory[itemNo][size].lot = lastLotNumber;

                saveState();
                applyFiltersAndRender();
                productionForm.reset();
                showModal(`${numberOfUnits}개의 LOT가 등록되었습니다. (총 ${totalQuantity} LB)`);
            });

            shippingForm.addEventListener('submit', e => {
                e.preventDefault();
                const itemNo = document.getElementById('ship-item').value.trim().toUpperCase();
                const size = document.getElementById('ship-size').value.trim();
                const client = document.getElementById('ship-client').value.trim();
                const lot = document.getElementById('ship-lot').value.trim();
                const quantity = parseFloat(document.getElementById('ship-quantity').value);

                if (!itemNo || !size || !lot || isNaN(quantity) || quantity <= 0) return showModal('ITEM NO, SIZE, LOT NO, 수량(LB)은 필수 항목입니다.');

                const currentStock = state.inventory[itemNo]?.[size]?.quantity || 0;
                if (currentStock < quantity) return showModal(`재고 부족. (현재고: ${currentStock.toFixed(1)} LB)`);

                state.inventory[itemNo][size].quantity -= quantity;
                state.shippingLog.push({ itemNo, size, lot, quantity, client, timestamp: new Date().toISOString() });
                
                saveState();
                applyFiltersAndRender();
                shippingForm.reset();
                showModal('출고 처리 완료.');
            });
            
            // Event Listeners for filters
            filterInventoryItemInput.addEventListener('input', applyFiltersAndRender);
            filterInventorySizeInput.addEventListener('input', applyFiltersAndRender);
            filterProductionLogInput.addEventListener('input', applyFiltersAndRender);
            filterShippingLogInput.addEventListener('input', applyFiltersAndRender);

            // Initial Load
            loadState();
            applyFiltersAndRender();
        });
    </script>
</body>
</html>

