<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§¤ë§¤ì¼ì§€</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --red: #ef4444; --red-bg: #fef2f2; --red-text: #b91c1c;
            --blue: #3b82f6; --blue-bg: #eff6ff; --blue-text: #1d4ed8;
            --green: #22c55e; --green-bg: #dcfce7; --green-text: #15803d;
            --gray: #64748b; --bg: #f1f5f9; --surface: #ffffff;
            --text-main: #0f172a; --text-sub: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text-main); margin: 0; padding: 20px; line-height: 1.4; font-size: 14px; }
        .container { max-width: 1400px; margin: 0 auto; background: var(--surface); padding: 20px; border-radius: 20px; box-shadow: var(--shadow); }
        
        /* í—¤ë” & ì»¨íŠ¸ë¡¤ */
        .main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .main-title { font-size: 24px; font-weight: 900; margin: 0; display:flex; align-items:center; gap:10px; }
        .util-btn { padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: white; cursor: pointer; font-weight: 700; color: var(--text-sub); font-size: 13px; transition: 0.2s; display:flex; align-items:center; gap:5px; }

        /* ì‹œí¬ë¦¿ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        body.privacy-mode .summary-grid, body.privacy-mode .charts-row, body.privacy-mode .search-bar { display: none !important; }

        /* í†µê³„ ì¹´ë“œ 7ê°œ */
        .summary-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-bottom: 20px; }
        @media (max-width: 1200px) { .summary-grid { grid-template-columns: repeat(4, 1fr); } }
        .stat-card { background: #f8fafc; padding: 15px; border-radius: 12px; border: 1px solid var(--border); }
        .stat-card h3 { margin: 0; font-size: 11px; color: var(--text-sub); font-weight: 700; }
        .stat-card p { margin: 5px 0 0 0; font-size: 18px; font-weight: 800; letter-spacing: -0.5px; }
        .sub-stat { font-size: 11px; color: #94a3b8; margin-top: 2px; }

        /* ì°¨íŠ¸ */
        .charts-row { display: grid; grid-template-columns: 2.5fr 1fr; gap: 15px; margin-bottom: 20px; }
        .chart-card { background: var(--surface); padding: 15px; border-radius: 12px; border: 1px solid var(--border); height: 250px; }

        /* ë‹¬ë ¥ í—¤ë” ì •ë ¬ ìˆ˜ì • */
        .calendar-header { display: flex; justify-content: center; align-items: center; gap: 30px; margin-bottom: 15px; background: var(--bg); padding: 12px; border-radius: 12px; }
        .calendar-header h2 { margin: 0; font-size: 20px; font-weight: 800; min-width: 150px; text-align: center; }

        /* ë‹¬ë ¥ ê·¸ë¦¬ë“œ */
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--border); border: 1px solid var(--border); }
        .day { background: white; min-height: 120px; padding: 8px; cursor: pointer; }
        .day-num { font-weight: 700; font-size: 12px; color: var(--text-sub); }
        .badge { font-size: 10px; padding: 4px 6px; border-radius: 4px; margin-bottom: 3px; font-weight: 600; display: flex; justify-content: space-between; }
        .badge-buy { background: var(--red-bg); color: var(--red-text); }
        /* ë§¤ë„: ë°°ê²½ íŒŒë€ìƒ‰, ê¸€ììƒ‰ ë¡œì§ì€ JSì—ì„œ ì²˜ë¦¬ */
        .badge-sell { background: var(--blue-bg); border: 1px solid rgba(59,130,246,0.2); }

        /* ëª¨ë‹¬ (ìˆ˜ì§ UI ì™„ë²½ ë³µêµ¬) */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; }
        .modal { background: white; border-radius: 12px; width: 450px; max-height: 95vh; overflow-y: auto; display: flex; flex-direction: column; }
        .modal-header { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 15px; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 12px; font-weight: 700; color: var(--text-sub); margin-bottom: 5px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; box-sizing: border-box; outline: none; }
        
        .calc-box { border: 1px solid var(--border); border-radius: 8px; margin-bottom: 15px; background: #f8fafc; padding: 10px; }
        .calc-row { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-sub); margin-bottom: 4px; }
        
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn-main { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 15px; }

        .calc-modal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:320px; background:var(--surface); padding:20px; border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,0.2); z-index:3000; border:1px solid var(--border); }
        .item-card { border: 1px solid var(--border); border-radius: 8px; padding: 10px; margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center; }
        .sm-btn { padding: 4px 8px; font-size: 11px; border: 1px solid var(--border); background: white; border-radius: 4px; cursor: pointer; font-weight: 600; color: var(--text-sub); }
    </style>
</head>
<body>

<div class="container" id="captureTarget">
    <div class="main-header">
        <h1 class="main-title">ğŸš€ í•˜ë£¨ 20ë§Œì› ëª©í‘œ</h1>
        <div style="display:flex; gap:5px;">
            <button class="util-btn" onclick="captureScreen()">ğŸ“· ìŠ¤í¬ë¦°ìƒ·</button>
            <button class="util-btn" onclick="openCalc()">ğŸ§® ë¬¼íƒ€ê¸° ê³„ì‚°ê¸°</button>
            <button class="util-btn active" id="togglePrivacyBtn" onclick="togglePrivacy()">ğŸ”’ ë‹¬ë ¥ë§Œ ë³´ê¸°</button>
            <button class="util-btn" onclick="exportData()">ğŸ’¾ ë°±ì—…</button>
            <button class="util-btn" onclick="document.getElementById('fileInput').click()">ğŸ“‚ ë³µêµ¬</button>
            <input type="file" id="fileInput" style="display:none" onchange="importData(this)">
        </div>
    </div>

    <div class="summary-grid">
        <div class="stat-card"><h3>ğŸ’° ì´ ëˆ„ì  ì†ìµ</h3><p id="totalProfit">0ì›</p></div>
        <div class="stat-card"><h3>ğŸ“‰ ì´ë²ˆ ë‹¬ ìˆ˜ìµ</h3><p id="monthProfit">0ì›</p></div>
        <div class="stat-card"><h3>ğŸŒ ê¸ˆì¼ ìˆ˜ìµ</h3><p id="todayProfit">0ì›</p></div>
        <div class="stat-card"><h3>ğŸ¯ ìŠ¹ë¥  (WIN RATE)</h3><p id="winRate">0%</p><div class="sub-stat" id="winLossCnt">0ìŠ¹ 0íŒ¨</div></div>
        <div class="stat-card"><h3>ğŸ§® PROFIT FACTOR</h3><p id="profitFactor">0.0</p><div class="sub-stat">ì´ìˆ˜ìµ/ì´ì†ì‹¤</div></div>
        <div class="stat-card"><h3>âš–ï¸ í‰ê·  ì†ìµë¹„</h3><p id="avgRatio">0:0</p><div class="sub-stat">í‰ê· ìµ:í‰ê· ì†</div></div>
        <div class="stat-card"><h3>â±ï¸ í‰ê·  ë³´ìœ ì¼</h3><p id="avgHold">0ì¼</p></div>
    </div>

    <div class="charts-row">
        <div class="chart-card"><canvas id="assetChart"></canvas></div>
        <div class="chart-card"><canvas id="portfolioChart"></canvas></div>
    </div>

    <div class="calendar-header">
        <button class="util-btn" onclick="changeMonth(-1)">â—€ ì´ì „</button>
        <h2 id="currentMonthLabel"></h2>
        <button class="util-btn" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
    </div>
    <div class="calendar" id="calendarGrid"></div>
</div>

<div id="calcModal" class="calc-modal">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><h3 style="margin:0; font-size:16px;">ğŸ§® í‰ë‹¨ê°€ ê³„ì‚°</h3><span onclick="closeCalc()" style="cursor:pointer; font-size:20px;">&times;</span></div>
    <div style="display:flex; flex-direction:column; gap:10px;">
        <input type="number" id="c_curPrice" placeholder="í˜„ì¬ ë‹¨ê°€">
        <input type="number" id="c_curQty" placeholder="í˜„ì¬ ìˆ˜ëŸ‰">
        <input type="number" id="c_addPrice" placeholder="ì¶”ê°€ ë‹¨ê°€">
        <input type="number" id="c_addQty" placeholder="ì¶”ê°€ ìˆ˜ëŸ‰">
        <button class="util-btn" style="background:var(--blue); color:white; justify-content:center; padding:12px;" onclick="runCalc()">ê³„ì‚°í•˜ê¸°</button>
        <div id="c_resultAvg" style="text-align:center; font-size:18px; font-weight:800; color:var(--blue-text); margin-top:10px;">-ì›</div>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this) closeModal()">
    <div class="modal">
        <div class="modal-header">
            <h2 style="margin:0; font-size:16px; font-weight:800;">ê±°ë˜ ì…ë ¥</h2>
            <div style="display:flex; gap:10px; align-items:center;">
                <button class="util-btn" onclick="showReceipt()" style="padding:4px 8px; font-size:11px;">ğŸ§¾ ì˜ìˆ˜ì¦</button>
                <span onclick="closeModal()" style="cursor:pointer; font-size:20px; color:#999;">&times;</span>
            </div>
        </div>
        <div class="modal-body">
            <div class="form-group"><label>ë‚ ì§œ</label><input type="date" id="inputDate"></div>
            <div style="display:grid; grid-template-columns: 1fr 2fr; gap:10px;">
                <div class="form-group">
                    <label>êµ¬ë¶„</label>
                    <select id="inputType" onchange="handleTypeChange()">
                        <option value="buy">ë§¤ìˆ˜ (Buy)</option><option value="sell">ë§¤ë„ (Sell)</option><option value="other">ê¸°íƒ€ (ì˜ˆìˆ˜ê¸ˆ)</option>
                    </select>
                </div>
                <div class="form-group"><label>ì¢…ëª©ëª…</label><input type="text" id="inputName" placeholder="ì¢…ëª©ëª… ì…ë ¥"></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div class="form-group"><label id="priceLabel">ë‹¨ê°€</label><input type="number" id="inputPrice" oninput="calc()"></div>
                <div class="form-group"><label>ìˆ˜ëŸ‰</label><input type="number" id="inputQty" value="1" oninput="calc()"></div>
            </div>
            <div class="form-group"><label>ğŸ“ ë§¤ë§¤ ë©”ëª¨ (ë³µê¸°)</label><textarea id="inputMemo" rows="3"></textarea></div>
            <div class="calc-box">
                <div class="calc-row"><span>ê±°ë˜ ê¸ˆì•¡:</span><span id="c_base">0ì›</span></div>
                <div class="calc-row"><span>ìˆ˜ìˆ˜ë£Œ/ì„¸ê¸ˆ:</span><span id="c_fee">0ì›</span></div>
                <div style="border-top:1px solid var(--border); margin:5px 0;"></div>
                <div style="display:flex; justify-content:space-between; padding:5px 10px; font-weight:800;"><span>ìµœì¢… ì •ì‚°:</span><span id="calcTotal" style="font-size:16px;">0ì›</span></div>
            </div>
            <div class="btn-group">
                <button class="btn-main" onclick="closeModal()" style="background:#e2e8f0;">ì·¨ì†Œ</button>
                <button class="btn-main" onclick="save()" style="background:#1e293b; color:white;">ì €ì¥</button>
            </div>
            <div style="font-size:12px; font-weight:800; color:var(--text-sub); margin-bottom:10px;">ğŸ“… ë‹¹ì¼ ê¸°ë¡</div>
            <div id="dayLogList"></div>
            <div style="font-size:12px; font-weight:800; color:var(--blue-text); margin:15px 0 10px 0;">ğŸ“¦ í†µí•© ë³´ìœ  ëª©ë¡</div>
            <div id="holdingsList"></div>
        </div>
    </div>
</div>

<script>
    let currentDate = new Date(), transactions = JSON.parse(localStorage.getItem('stockData_v30')) || [];
    let assetChart=null, portfolioChart=null, editingId = null;
    const FEE = 0.000140527, TAX = 0.0018;

    function init() { renderCalendar(); updateSummary(); }

    function updateSummary() {
        let tp=0, mp=0, dp=0, sc=0, lc=0, winSum=0, lossSum=0, totalHoldDays=0, holdCount=0;
        let todayStr = new Date().toISOString().split('T')[0], cmStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2,'0')}`;
        let balanceHistory = [0], dates = ['Start'], holdings = {};

        [...transactions].sort((a,b)=>new Date(a.date)-new Date(b.date)).forEach(t => {
            if(t.type === 'sell') {
                tp += t.profit;
                if(t.date.startsWith(cmStr)) mp += t.profit;
                if(t.date === todayStr) dp += t.profit;
                if(t.profit >= 0) { sc++; winSum += t.profit; } else { lc++; lossSum += Math.abs(t.profit); }
                if(t.holdDays !== undefined) { totalHoldDays += t.holdDays; holdCount++; }
                balanceHistory.push(tp); dates.push(t.date);
            } else if(t.type === 'buy' && t.remainingQty > 0) {
                holdings[t.name] = (holdings[t.name] || 0) + (t.remainingQty * t.price);
            } else if(t.type === 'other') {
                tp += t.price; balanceHistory.push(tp); dates.push(t.date);
            }
        });

        document.getElementById('totalProfit').innerText = tp.toLocaleString() + 'ì›';
        document.getElementById('monthProfit').innerText = mp.toLocaleString() + 'ì›';
        document.getElementById('todayProfit').innerText = dp.toLocaleString() + 'ì›';
        document.getElementById('winRate').innerText = (sc+lc > 0 ? (sc/(sc+lc)*100).toFixed(1) : 0) + '%';
        document.getElementById('winLossCnt').innerText = `${sc}ìŠ¹ ${lc}íŒ¨`;
        document.getElementById('profitFactor').innerText = lossSum > 0 ? (winSum/lossSum).toFixed(2) : (winSum>0?'âˆ':'0.0');
        let avgWin = sc > 0 ? winSum/sc : 0, avgLoss = lc > 0 ? lossSum/lc : 0;
        document.getElementById('avgRatio').innerText = `${(avgWin/10000).toFixed(1)} : ${(avgLoss/10000).toFixed(1)}`;
        document.getElementById('avgHold').innerText = (holdCount > 0 ? Math.round(totalHoldDays/holdCount) : 0) + 'ì¼';

        renderCharts(dates, balanceHistory, holdings);
    }

    function renderCharts(labels, data, holdings) {
        if(assetChart) assetChart.destroy();
        assetChart = new Chart(document.getElementById('assetChart'), { type:'line', data:{labels, datasets:[{data, borderColor:'#3b82f6', fill:true, backgroundColor:'rgba(59,130,246,0.1)', tension:0.3, pointRadius:0}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{display:false}}}});
        if(portfolioChart) portfolioChart.destroy();
        portfolioChart = new Chart(document.getElementById('portfolioChart'), { type:'pie', data:{labels:Object.keys(holdings), datasets:[{data:Object.values(holdings), backgroundColor:['#ef4444','#3b82f6','#22c55e','#eab308','#a855f7']}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom', labels:{boxWidth:12}}}}});
    }

    function renderCalendar() {
        const grid=document.getElementById('calendarGrid'), y=currentDate.getFullYear(), m=currentDate.getMonth();
        document.getElementById('currentMonthLabel').innerText=`${y}ë…„ ${m+1}ì›”`;
        grid.innerHTML=`<div style="background:#f8fafc; padding:10px; text-align:center; font-weight:700; color:red;">ì¼</div><div style="background:#f8fafc; padding:10px; text-align:center; font-weight:700;">ì›”</div><div style="background:#f8fafc; padding:10px; text-align:center; font-weight:700;">í™”</div><div style="background:#f8fafc; padding:10px; text-align:center; font-weight:700;">ìˆ˜</div><div style="background:#f8fafc; padding:10px; text-align:center; font-weight:700;">ëª©</div><div style="background:#f8fafc; padding:10px; text-align:center; font-weight:700;">ê¸ˆ</div><div style="background:#f8fafc; padding:10px; text-align:center; font-weight:700; color:blue;">í† </div>`;
        const first=new Date(y,m,1).getDay(), last=new Date(y,m+1,0).getDate();
        for(let i=0;i<first;i++) grid.innerHTML+=`<div style="background:#f9fafb; min-height:120px;"></div>`;
        for(let i=1;i<=last;i++){
            const dStr=`${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
            const logs=transactions.filter(t=>t.date===dStr);
            let dayP = 0, badges = '';
            logs.forEach(l => {
                if(l.type==='buy') badges += `<div class="badge badge-buy"><span>${l.name}</span><span>${l.qty}ì£¼</span></div>`;
                else if(l.type==='sell') { 
                    dayP += l.profit; 
                    badges += `<div class="badge badge-sell"><span>${l.name}</span><span style="color: ${l.profit>=0 ? '#ef4444' : '#3b82f6'}">${l.profit>=0?'+':''}${(l.profit/10000).toFixed(1)}ë§Œ</span></div>`; 
                }
                else badges += `<div class="badge badge-other"><span>${l.name}</span></div>`;
            });
            grid.innerHTML+=`<div class="day" onclick="openModal('${dStr}')"><div class="day-num">${i}</div>${badges}<div style="font-size:10px; font-weight:900; text-align:right; margin-top:auto; color:${dayP>=0?'var(--blue)':'var(--red)'}">${dayP!==0?dayP.toLocaleString():''}</div></div>`;
        }
    }

    function openModal(dStr) { 
        editingId = null; document.getElementById('modalOverlay').style.display='flex'; 
        document.getElementById('inputDate').value=dStr; document.getElementById('inputName').value=''; 
        document.getElementById('inputPrice').value=''; document.getElementById('inputQty').value='1';
        document.getElementById('inputMemo').value=''; renderDayLog(dStr); renderHold(); handleTypeChange();
    }
    function closeModal() { document.getElementById('modalOverlay').style.display='none'; }
    function handleTypeChange() { const t = document.getElementById('inputType').value; document.getElementById('priceLabel').innerText = (t==='buy'?'ë§¤ìˆ˜ ë‹¨ê°€':(t==='sell'?'ë§¤ë„ ë‹¨ê°€':'ê¸ˆì•¡')); calc(); }
    function calc() { const p=Number(document.getElementById('inputPrice').value), q=Number(document.getElementById('inputQty').value), t=document.getElementById('inputType').value; let base=p*q, fee=Math.floor(base*FEE), tax=(t==='sell'?Math.floor(base*TAX):0); document.getElementById('c_base').innerText=base.toLocaleString()+'ì›'; document.getElementById('c_fee').innerText=(fee+tax).toLocaleString()+'ì›'; document.getElementById('calcTotal').innerText=(t==='buy'?base+fee:base-fee-tax).toLocaleString()+'ì›'; }

    function save() {
        const d=document.getElementById('inputDate').value, t=document.getElementById('inputType').value, n=document.getElementById('inputName').value, p=Number(document.getElementById('inputPrice').value), q=Number(document.getElementById('inputQty').value), m=document.getElementById('inputMemo').value;
        if(!n || !p) return;
        if(t==='sell') {
            let buys = transactions.filter(x=>x.type==='buy' && x.name===n && x.remainingQty>0).sort((a,b)=>new Date(a.date)-new Date(b.date));
            if(q > buys.reduce((a,c)=>a+c.remainingQty, 0)){alert('ìˆ˜ëŸ‰ë¶€ì¡±');return;}
            let totalBuyQty = buys.reduce((a,c)=>a+c.remainingQty,0);
            let avgP = buys.reduce((a,c)=>a+(c.remainingQty*c.price),0)/totalBuyQty;
            transactions.push({id:Date.now(), date:d, type:'sell', name:n, price:p, qty:q, profit:Math.round((p*q*(1-FEE-TAX))-(avgP*q*(1+FEE))), memo:m, holdDays:Math.ceil((new Date(d)-new Date(buys[0].date))/(1000*60*60*24))});
            let rem=q; buys.forEach(b=>{if(rem>0){let dQ=Math.min(b.remainingQty, rem); b.remainingQty-=dQ; rem-=dQ;}});
        } else transactions.push({id:Date.now(), date:d, type:t, name:n, price:p, qty:q, remainingQty:q, memo:m});
        localStorage.setItem('stockData_v30', JSON.stringify(transactions)); init(); openModal(d);
    }

    function renderDayLog(dStr) { document.getElementById('dayLogList').innerHTML = transactions.filter(t=>t.date===dStr).map(t=>`<div class="item-card"><div><b>[${t.type}] ${t.name}</b><br><small>${t.qty}ì£¼ / ${t.type==='sell'?t.profit.toLocaleString():t.price.toLocaleString()}ì›</small></div><div><button class="sm-btn" onclick="del(${t.id})">ì‚­ì œ</button></div></div>`).join(''); }
    function renderHold() { let hMap = {}; transactions.filter(x=>x.type==='buy' && x.remainingQty>0).forEach(t=>{ if(!hMap[t.name]) hMap[t.name]={q:0, c:0}; hMap[t.name].q+=t.remainingQty; hMap[t.name].c+=(t.remainingQty*t.price); }); document.getElementById('holdingsList').innerHTML = Object.keys(hMap).map(k=>`<div class="item-card"><div><b>${k}</b><br><small>í‰ë‹¨ ${Math.round(hMap[k].c/hMap[k].q).toLocaleString()}ì› / ${hMap[k].q}ì£¼</small></div></div>`).join(''); }
    function del(id) { if(confirm("ì‚­ì œ?")){transactions=transactions.filter(x=>x.id!==id); localStorage.setItem('stockData_v30', JSON.stringify(transactions)); init(); closeModal(); }}
    function togglePrivacy() { document.body.classList.toggle('privacy-mode'); }
    function changeMonth(v) { currentDate.setMonth(currentDate.getMonth()+v); renderCalendar(); }
    function openCalc() { document.getElementById('calcModal').style.display='block'; }
    function closeCalc() { document.getElementById('calcModal').style.display='none'; }
    function runCalc() { const cp=Number(document.getElementById('c_curPrice').value), cq=Number(document.getElementById('c_curQty').value), ap=Number(document.getElementById('c_addPrice').value), aq=Number(document.getElementById('c_addQty').value); document.getElementById('c_resultAvg').innerText = Math.round((cp*cq + ap*aq)/(cq+aq)).toLocaleString()+'ì›'; }
    function captureScreen() { html2canvas(document.getElementById('captureTarget')).then(c => { const a=document.createElement('a'); a.download='TradingLog.png'; a.href=c.toDataURL(); a.click(); }); }
    function exportData() { const a=document.createElement('a'); a.href='data:text/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(transactions)); a.download='backup.json'; a.click(); }
    function importData(i) { const r=new FileReader(); r.onload=e=>{ transactions=JSON.parse(e.target.result); localStorage.setItem('stockData_v30', JSON.stringify(transactions)); location.reload(); }; r.readAsText(i.files[0]); }
    function showReceipt() { /* ì˜ìˆ˜ì¦ ë¡œì§ ìƒëµ */ }
    init();
</script>
</body>
</html>
