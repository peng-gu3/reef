<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•´ìˆ˜í•­ ê´€ë¦¬ì¼ì§€ (Supabase ì—°ë™)</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.12.7/umd/Recharts.min.js"></script>
    <style>
        body { background-color: #1a202c; } .recharts-legend-item { cursor: pointer; } .loader { border: 4px solid #4A5568; border-top: 4px solid #2563eb; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .sync-status { position: fixed; top: 20px; right: 20px; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: bold; z-index: 1000; display: flex; align-items: center; gap: 8px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==================================================================
        // â—ï¸â—ï¸ 1ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ Supabase ì •ë³´ë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš” â—ï¸â—ï¸
        const SUPABASE_URL = 'https://ljbthcdvbebgeimfbmxi.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxqYnRoY2R2YmViZ2VpbWZibXhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyMDM1ODksImV4cCI6MjA2OTc3OTU4OX0.K6oJR8oyfL39qUAhfJe72uyNxLariXiIYEtz3iO5Mv4';
        // ==================================================================

        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const { useState, useEffect, useCallback } = React;
        // (TARGET_RANGES, chartLines, calculateDosing ë“± UI ê´€ë ¨ í•¨ìˆ˜ëŠ” ê¸°ì¡´ê³¼ ë™ì¼)
        const TARGET_RANGES = { temp: { min: 25.5, max: 26.5, unit: 'Â°C' }, salinity: { min: 34.0, max: 35.0, unit: 'ppt' }, ph: { min: 8.0, max: 8.4, unit: '' }, kh: { min: 7.3, max: 8.0, unit: 'dKH' }, calcium: { min: 400, max: 430, unit: 'ppm' }, magnesium: { min: 1350, max: 1440, unit: 'ppm' }, nitrite: { min: 0, max: 0, unit: 'ppm' }, nitrate: { min: 0.5, max: 2.0, unit: 'ppm' }, phosphate: { min: 0.03, max: 0.07, unit: 'ppm' }, };
        const chartLines = [ { dataKey: 'temp', name: 'ì˜¨ë„ (Â°C)', color: '#FF69B4', yAxisId: 'left' }, { dataKey: 'salinity', name: 'ì—¼ë„ (ppt)', color: '#00BFFF', yAxisId: 'left' }, { dataKey: 'ph', name: 'pH', color: '#DA70D6', yAxisId: 'left' }, { dataKey: 'kh_am', name: 'KH (ì˜¤ì „)', color: '#4169E1', yAxisId: 'left' }, { dataKey: 'kh_pm', name: 'KH (ì˜¤í›„)', color: '#87CEFA', yAxisId: 'left' }, { dataKey: 'calcium', name: 'ì¹¼ìŠ˜ (ppm)', color: '#3CB371', yAxisId: 'right' }, { dataKey: 'magnesium', name: 'ë§ˆê·¸ë„¤ìŠ˜ (ppm)', color: '#FFD700', yAxisId: 'right' }, { dataKey: 'nitrite', name: 'ì•„ì§ˆì‚° (ppm)', color: '#DC143C', yAxisId: 'left' }, { dataKey: 'nitrate', name: 'ì§ˆì‚°ì—¼ (ppm)', color: '#FF4500', yAxisId: 'left' }, { dataKey: 'phosphate', name: 'ì¸ì‚°ì—¼ (ppm)', color: '#32CD32', yAxisId: 'left' }, ];
        const calculateDosing = (log, waterVolume) => { const dosing = {}; if (!log || typeof waterVolume !== 'number' || waterVolume <= 0) return dosing; const currentKh = log.kh_pm ?? log.kh_am; if (currentKh < TARGET_RANGES.kh.min) { dosing.kh = ((waterVolume * (TARGET_RANGES.kh.min - currentKh)) / 10).toFixed(2); } if (log.calcium < TARGET_RANGES.calcium.min) { dosing.calcium = ((waterVolume * (TARGET_RANGES.calcium.min - log.calcium)) / 200).toFixed(2); } if (log.magnesium < TARGET_RANGES.magnesium.min) { dosing.magnesium = ((waterVolume * (TARGET_RANGES.magnesium.min - log.magnesium)) / 100).toFixed(2); } if (log.nitrate < TARGET_RANGES.nitrate.min) { dosing.nitrate = ((waterVolume * (TARGET_RANGES.nitrate.min - log.nitrate)) / 100).toFixed(2); } if (log.phosphate < TARGET_RANGES.phosphate.min) { dosing.phosphate = ((waterVolume * (TARGET_RANGES.phosphate.min - log.phosphate)) / 10).toFixed(2); } return dosing; };

        const App = () => {
            const [logs, setLogs] = useState([]);
            const [syncStatus, setSyncStatus] = useState('loading');
            const [waterVolume, setWaterVolume] = useState(() => parseInt(localStorage.getItem('waterVolume') || '200', 10));
            // (ë‚˜ë¨¸ì§€ ìƒíƒœ ë³€ìˆ˜ë“¤ì€ ê¸°ì¡´ê³¼ ë™ì¼)
            const [isEditingVolume, setIsEditingVolume] = useState(false); const [tempVolume, setTempVolume] = useState(waterVolume); const [dosingStatus, setDosingStatus] = useState({}); const [hiddenLines, setHiddenLines] = useState({}); const [viewMode, setViewMode] = useState('latest'); const [analysisResult, setAnalysisResult] = useState(null); const [isLoadingAnalysis, setIsLoadingAnalysis] = useState(false); const [newLog, setNewLog] = useState({ date: new Date().toISOString().slice(0, 10), temp: '', salinity: '', ph: '', kh_am: '', kh_pm: '', calcium: '', magnesium: '', nitrite: '', nitrate: '', phosphate: '', notes: '' });
            
            const fetchLogs = useCallback(async () => {
                if (!SUPABASE_URL.includes('supabase.co')) {
                    alert('Supabase URLì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    setSyncStatus('error');
                    return;
                }
                setSyncStatus('loading');
                try {
                    const { data, error } = await supabaseClient
                        .from('logs')
                        .select()
                        .order('date', { ascending: false });

                    if (error) throw error;
                    setLogs(data);
                    setSyncStatus('synced');
                } catch (error) {
                    console.error("Supabase ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", error);
                    setSyncStatus('error');
                    alert(`ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ${error.message}`);
                }
            }, []);

            useEffect(() => { fetchLogs(); }, [fetchLogs]);

            const handleAddLog = async (e) => {
                e.preventDefault();
                // (ì…ë ¥ê°’ ê²€ì¦ ë¡œì§ì€ ê¸°ì¡´ê³¼ ë™ì¼)
                const requiredFields = ['date', 'temp', 'salinity', 'ph', 'kh_am', 'kh_pm', 'calcium', 'magnesium', 'nitrite', 'nitrate', 'phosphate'];
                if (requiredFields.some(field => !newLog[field])) { alert('ëª¨ë“  ìˆ˜ì§ˆ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

                setSyncStatus('syncing');
                // idì™€ created_atì€ Supabaseê°€ ìë™ìœ¼ë¡œ ìƒì„±í•˜ë¯€ë¡œ ì œì™¸
                const { id, created_at, ...logData } = newLog;

                const { error } = await supabaseClient.from('logs').insert([logData]);

                if (error) {
                    console.error("Supabase ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:", error);
                    setSyncStatus('error');
                    alert(`ë°ì´í„° ì €ì¥ ì‹¤íŒ¨: ${error.message}`);
                } else {
                    setSyncStatus('synced');
                    fetchLogs(); // ì €ì¥ í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    setNewLog({ date: new Date().toISOString().slice(0, 10), temp: '', salinity: '', ph: '', kh_am: '', kh_pm: '', calcium: '', magnesium: '', nitrite: '', nitrate: '', phosphate: '', notes: '' });
                }
            };

            const handleDeleteLog = async (idToDelete) => {
                if (window.confirm('ì •ë§ë¡œ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    setSyncStatus('syncing');
                    const { error } = await supabaseClient.from('logs').delete().eq('id', idToDelete);
                    if (error) {
                        console.error("Supabase ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:", error);
                        setSyncStatus('error');
                        alert(`ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨: ${error.message}`);
                    } else {
                        setSyncStatus('synced');
                        fetchLogs(); // ì‚­ì œ í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    }
                }
            };
            
            // (ë‚˜ë¨¸ì§€ ë Œë”ë§ ê´€ë ¨ í•¨ìˆ˜ ë° JSXëŠ” ê¸°ì¡´ ì½”ë“œì™€ ì™„ì „íˆ ë™ì¼í•©ë‹ˆë‹¤.)
            const handleSaveVolume = () => { setWaterVolume(tempVolume); localStorage.setItem('waterVolume', tempVolume); setIsEditingVolume(false); }; useEffect(() => { setTempVolume(waterVolume); }, [waterVolume]); const handleAnalysis = (log) => { setIsLoadingAnalysis(true); setAnalysisResult({ logDate: log.date, text: "" }); setTimeout(() => { const sampleAnalysis = `\n### âœ¨ ${log.date} ê¸°ë¡ ì¢…í•© ë¶„ì„\n\n#### 1. ì¢…í•© í‰ê°€\nì „ë°˜ì ìœ¼ë¡œ ì•ˆì •ì ì¸ ìƒíƒœë¥¼ í–¥í•´ ê°€ê³  ìˆìœ¼ë‚˜, ì‚°í˜¸ ì„±ì¥ì˜ í•µì‹¬ ìš”ì†Œì¸ KH, ì¹¼ìŠ˜, ë§ˆê·¸ë„¤ìŠ˜ ìˆ˜ì¹˜ê°€ ëª©í‘œì¹˜ë³´ë‹¤ ë‚®ì•„ ë³´ì¶©ì´ í•„ìš”í•œ ì‹œì ì…ë‹ˆë‹¤.\n\n#### 2. ê¸ì •ì ì¸ ì \n- **ì˜¨ë„, ì—¼ë„, pH, ì§ˆì‚°ì—¼, ì¸ì‚°ì—¼:** ëª¨ë“  ìˆ˜ì¹˜ê°€ ëª©í‘œ ë²”ìœ„ ë‚´ì—ì„œ ë§¤ìš° ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì§ˆì‚°ì—¼ê³¼ ì¸ì‚°ì—¼ ìˆ˜ì¹˜ê°€ ë‚®ê²Œ ê´€ë¦¬ë˜ëŠ” ì ì€ ì‚°í˜¸ì˜ ê±´ê°•í•œ ë°œìƒ‰ì— ë§¤ìš° ê¸ì •ì ì…ë‹ˆë‹¤. í›Œë¥­í•©ë‹ˆë‹¤!\n\n#### 3. ì£¼ì˜ ë° ê°œì„  í•„ìš” í•­ëª©\n- **KH (ì˜¤ì „ ${log.kh_am}, ì˜¤í›„ ${log.kh_pm} dKH):** ëª©í‘œì¹˜(7.3 ~ 8.0)ë³´ë‹¤ ì•½ê°„ ë‚®ìŠµë‹ˆë‹¤. KHëŠ” ì‚°í˜¸ì˜ ê³¨ê²© ì„±ì¥ì— ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œì´ë¯€ë¡œ ê¾¸ì¤€í•œ ë„ì§•ìœ¼ë¡œ ëª©í‘œ ë²”ìœ„ ë‚´ë¡œ ì˜¬ë ¤ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.\n- **ì¹¼ìŠ˜ (${log.calcium} ppm):** ëª©í‘œì¹˜(400 ~ 430)ë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤. KHì™€ í•¨ê»˜ ì‚°í˜¸ ê³¨ê²©ì„ êµ¬ì„±í•˜ëŠ” í•µì‹¬ ë¯¸ë„¤ë„ì´ë¯€ë¡œ ë³´ì¶©ì´ í•„ìš”í•©ë‹ˆë‹¤.\n- **ë§ˆê·¸ë„¤ìŠ˜ (${log.magnesium} ppm):** ëª©í‘œì¹˜(1350 ~ 1440)ë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤. ë§ˆê·¸ë„¤ìŠ˜ì€ ì¹¼ìŠ˜ê³¼ KHê°€ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë˜ë„ë¡ ë•ëŠ” ì—­í• ì„ í•˜ë¯€ë¡œ, ë‹¤ë¥¸ ë‘ ìš”ì†Œì™€ í•¨ê»˜ ê¾¸ì¤€íˆ ê´€ë¦¬í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.\n\n#### 4. ë‹¤ìŒ ê´€ë¦¬ íŒ\n- **ë„ì§•:** ê³„ì‚°ëœ ë„ì§•ëŸ‰ì„ ì°¸ê³ í•˜ì—¬ KH, ì¹¼ìŠ˜, ë§ˆê·¸ë„¤ìŠ˜ì„ ê¾¸ì¤€íˆ ë³´ì¶©í•´ì£¼ì„¸ìš”. í•œ ë²ˆì— ë„ˆë¬´ ë§ì€ ì–‘ì„ ë„£ê¸°ë³´ë‹¤ëŠ”, ì¼ì£¼ì¼ ë¶„ëŸ‰ì„ ê³„ì‚°í•˜ì—¬ ë§¤ì¼ ì¡°ê¸ˆì”© ë‚˜ëˆ„ì–´ íˆ¬ì—¬í•˜ëŠ” ê²ƒì´ ìˆ˜ì§ˆ ë³€í™”ë¥¼ ìµœì†Œí™”í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.\n- **ê´€ì°°:** ë„ì§• í›„ ì‚°í˜¸ì˜ í´ë¦½ ë°˜ì‘ì´ë‚˜ ìƒ‰ìƒ ë³€í™”ë¥¼ ê¾¸ì¤€íˆ ê´€ì°°í•˜ë©° ì–´í•­ì˜ ë³€í™”ì— ëŒ€ì‘í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.\n`; setAnalysisResult({ logDate: log.date, text: sampleAnalysis }); setIsLoadingAnalysis(false); }, 1500); }; const handleInputChange = (e) => { const { name, value } = e.target; setNewLog({ ...newLog, [name]: value }); }; const toggleDosingStatus = (logId, param) => { setDosingStatus(prev => ({ ...prev, [`${logId}-${param}`]: !prev[`${logId}-${param}`] })); }; const handleLegendClick = (e) => { const { dataKey } = e; setHiddenLines(prev => ({ ...prev, [dataKey]: !prev[dataKey] })); }; const getFilteredLogs = () => { const today = new Date(); const todayStr = today.toISOString().slice(0, 10); switch (viewMode) { case 'latest': return logs.length > 0 ? [logs[0]] : []; case 'today': return logs.filter(log => log.date === todayStr); case 'last7days': const sevenDaysAgo = new Date(); sevenDaysAgo.setDate(today.getDate() - 7); return logs.filter(log => new Date(log.date) >= sevenDaysAgo); default: return logs; } }; const filteredLogs = getFilteredLogs(); const renderCustomLegend = (props) => { const { payload } = props; return ( <div className="flex justify-center flex-wrap mt-4"> {payload.map((entry, index) => { const { dataKey, color, value } = entry; const isHidden = hiddenLines[dataKey]; return ( <div key={`item-${index}`} onClick={() => handleLegendClick({ dataKey })} className="flex items-center mr-4 mb-2" style={{ opacity: isHidden ? 0.5 : 1, cursor: 'pointer' }} > <div style={{ width: '14px', height: '14px', backgroundColor: color, marginRight: '8px' }}></div> <span style={{ color: color, fontSize: '14px', fontWeight: 500 }}>{value}</span> </div> ); })} </div> ); }; const renderChart = () => { if (!window.Recharts) { return <div className="flex items-center justify-center h-full text-yellow-400">ê·¸ë˜í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì¤‘...</div>; } const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts; const chartData = [...logs].sort((a, b) => new Date(a.date) - new Date(b.date)); return ( <ResponsiveContainer width="100%" height={400}> <LineChart data={chartData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}> <CartesianGrid strokeDasharray="3 3" stroke="#4A5568" /> <XAxis dataKey="date" stroke="#A0AEC0" /> <YAxis yAxisId="left" stroke="#A0AEC0" domain={['dataMin - 1', 'dataMax + 1']} /> <YAxis yAxisId="right" orientation="right" stroke="#A0AEC0" domain={['dataMin - 50', 'dataMax + 50']} /> <Tooltip contentStyle={{ backgroundColor: '#1A202C', border: '1px solid #4A5568' }} /> <Legend content={renderCustomLegend} /> {chartLines.map(line => ( <Line key={line.dataKey} hide={hiddenLines[line.dataKey]} dataKey={line.dataKey} name={line.name} stroke={line.color} yAxisId={line.yAxisId} type="monotone" /> ))} </LineChart> </ResponsiveContainer> ); }; const SyncStatusIndicator = () => { let statusInfo = { text: 'ë¡œë”© ì¤‘...', color: 'bg-yellow-500', showSpinner: true }; switch (syncStatus) { case 'synced': statusInfo = { text: 'Supabase ë™ê¸°í™” ì™„ë£Œ', color: 'bg-green-600', showSpinner: false }; break; case 'syncing': statusInfo = { text: 'Supabase ì €ì¥ ì¤‘...', color: 'bg-blue-500', showSpinner: true }; break; case 'error': statusInfo = { text: 'ë™ê¸°í™” ì˜¤ë¥˜ ë°œìƒ', color: 'bg-red-600', showSpinner: false }; break; } return ( <div className={`sync-status ${statusInfo.color} text-white`}> {statusInfo.showSpinner && <div className="loader !w-4 !h-4 !border-2"></div>} <span>{statusInfo.text}</span> </div> ); }; if (syncStatus === 'loading' && logs.length === 0) { return ( <div className="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center"> <div className="loader"></div> <p className="mt-4 text-lg">Supabaseì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p> </div> ); } return ( <div className="bg-gray-900 text-white min-h-screen font-sans p-4 md:p-8"> <SyncStatusIndicator /> <div className="container mx-auto max-w-7xl"> <header className="text-center mb-8"> <h1 className="text-4xl font-bold text-cyan-400">í•´ìˆ˜í•­ ê´€ë¦¬ì¼ì§€ (Supabase)</h1> </header> <div className="bg-gray-800 p-4 rounded-xl mb-8 flex items-center space-x-4"> <label className="font-bold text-lg">ìˆ˜ì¡° ì´ ë¬¼ëŸ‰ (L):</label> {isEditingVolume ? ( <> <input type="number" value={tempVolume} onChange={(e) => setTempVolume(parseInt(e.target.value, 10) || 0)} className="bg-gray-700 w-32 p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500" /> <button onClick={handleSaveVolume} className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">ì €ì¥</button> <button onClick={() => setIsEditingVolume(false)} className="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">ì·¨ì†Œ</button> </> ) : ( <> <span className="text-lg font-semibold text-cyan-400">{waterVolume} L</span> <button onClick={() => setIsEditingVolume(true)} className="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">ìˆ˜ì •</button> </> )} </div> <div className="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8 h-[450px]"> <h2 className="text-2xl font-semibold mb-4 text-center">ìˆ˜ì§ˆ ë³€í™” ê·¸ë˜í”„</h2> {renderChart()} </div> <div className="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8"> <h2 className="text-2xl font-semibold mb-4">ìƒˆ ì¼ì§€ ì‘ì„±</h2> <form onSubmit={handleAddLog} className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 items-center"> <input type="date" name="date" value={newLog.date} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" step="0.1" name="temp" placeholder={`ì˜¨ë„ (Â°C)`} value={newLog.temp} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" step="0.1" name="salinity" placeholder={`ì—¼ë„ (ppt)`} value={newLog.salinity} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" step="0.1" name="ph" placeholder={`pH`} value={newLog.ph} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" step="0.1" name="kh_am" placeholder={`KH (ì˜¤ì „)`} value={newLog.kh_am} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" step="0.1" name="kh_pm" placeholder={`KH (ì˜¤í›„)`} value={newLog.kh_pm} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" name="calcium" placeholder={`ì¹¼ìŠ˜ (ppm)`} value={newLog.calcium} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" name="magnesium" placeholder={`ë§ˆê·¸ë„¤ìŠ˜ (ppm)`} value={newLog.magnesium} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" step="0.01" name="nitrite" placeholder={`ì•„ì§ˆì‚° (ppm)`} value={newLog.nitrite} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" step="0.01" name="nitrate" placeholder={`ì§ˆì‚°ì—¼ (ppm)`} value={newLog.nitrate} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="number" step="0.01" name="phosphate" placeholder={`ì¸ì‚°ì—¼ (ppm)`} value={newLog.phosphate} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg" /> <input type="text" name="notes" placeholder="íŠ¹ì´ì‚¬í•­" value={newLog.notes} onChange={handleInputChange} className="bg-gray-700 p-2 rounded-lg col-span-2 lg:col-span-3" /> <button type="submit" className="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 col-span-2 lg:col-span-2">ì¼ì§€ ì¶”ê°€</button> </form> </div> <main> <div className="flex justify-between items-center mb-4"> <h2 className="text-2xl font-semibold">ì „ì²´ ê¸°ë¡</h2> <div className="flex space-x-2"> <button onClick={() => setViewMode('latest')} className={`px-3 py-1 text-sm rounded-md ${viewMode === 'latest' ? 'bg-cyan-500' : 'bg-gray-600 hover:bg-gray-500'}`}>ìµœê·¼ 1ê°œ</button> <button onClick={() => setViewMode('today')} className={`px-3 py-1 text-sm rounded-md ${viewMode === 'today' ? 'bg-cyan-500' : 'bg-gray-600 hover:bg-gray-500'}`}>ì˜¤ëŠ˜</button> <button onClick={() => setViewMode('last7days')} className={`px-3 py-1 text-sm rounded-md ${viewMode === 'last7days' ? 'bg-cyan-500' : 'bg-gray-600 hover:bg-gray-500'}`}>ìµœê·¼ 7ì¼</button> </div> </div> <div className="space-y-4"> {filteredLogs.length > 0 ? filteredLogs.map(log => { const dosings = calculateDosing(log, waterVolume); const isKhAmOutOfRange = log.kh_am < TARGET_RANGES.kh.min || log.kh_am > TARGET_RANGES.kh.max; const isKhPmOutOfRange = log.kh_pm < TARGET_RANGES.kh.min || log.kh_pm > TARGET_RANGES.kh.max; const isOutOfRange = (param) => log[param] < TARGET_RANGES[param]?.min || log[param] > TARGET_RANGES[param]?.max; return ( <div key={log.id} className="bg-gray-800 p-4 rounded-lg border border-gray-700"> <div className="flex justify-between items-start mb-3"> <p className="font-bold text-lg text-cyan-400">{log.date}</p> <div> <button onClick={() => handleAnalysis(log)} className="bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1 px-2 rounded-lg mr-2">âœ¨ AI ë¶„ì„ ë° ì¡°ì–¸</button> <button onClick={() => handleDeleteLog(log.id)} className="bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded-lg">ì‚­ì œ</button> </div> </div> <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-x-4 gap-y-2 text-sm mb-4"> <p className={`flex items-center ${isOutOfRange('temp') ? 'text-red-400' : 'text-gray-300'}`}>ğŸŒ¡ï¸<span className="ml-2">ì˜¨ë„: {log.temp} Â°C</span></p> <p className={`flex items-center ${isOutOfRange('salinity') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ’§<span className="ml-2">ì—¼ë„: {log.salinity} ppt</span></p> <p className={`flex items-center ${isOutOfRange('ph') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ§ª<span className="ml-2">pH: {log.ph}</span></p> <p className={`flex items-center ${isKhAmOutOfRange ? 'text-red-400' : 'text-gray-300'}`}>ğŸ’<span className="ml-2">KH (ì˜¤ì „): {log.kh_am} dKH</span></p> <p className={`flex items-center ${isKhPmOutOfRange ? 'text-red-400' : 'text-gray-300'}`}>ğŸ’<span className="ml-2">KH (ì˜¤í›„): {log.kh_pm} dKH</span></p> <p className={`flex items-center ${isOutOfRange('calcium') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ¦´<span className="ml-2">ì¹¼ìŠ˜: {log.calcium} ppm</span></p> <p className={`flex items-center ${isOutOfRange('magnesium') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ”©<span className="ml-2">ë§ˆê·¸ë„¤ìŠ˜: {log.magnesium} ppm</span></p> <p className={`flex items-center ${isOutOfRange('nitrite') ? 'text-red-400' : 'text-gray-300'}`}>ğŸš«<span className="ml-2">ì•„ì§ˆì‚°: {log.nitrite} ppm</span></p> <p className={`flex items-center ${isOutOfRange('nitrate') ? 'text-red-400' : 'text-gray-300'}`}>ğŸŒ¿<span className="ml-2">ì§ˆì‚°ì—¼: {log.nitrate} ppm</span></p> <p className={`flex items-center ${isOutOfRange('phosphate') ? 'text-red-400' : 'text-gray-300'}`}>ğŸ¦ <span className="ml-2">ì¸ì‚°ì—¼: {log.phosphate} ppm</span></p> </div> <div className="border-t border-gray-700 pt-3"> <h4 className="font-semibold text-md mb-2">ë„ì§• ê´€ë¦¬</h4> <div className="flex flex-wrap gap-4"> {Object.keys(dosings).map(param => ( <div key={param}><button onClick={() => toggleDosingStatus(log.id, param)} className={`py-1 px-3 rounded-lg text-xs font-bold ${dosingStatus[`${log.id}-${param}`] ? 'bg-green-600' : 'bg-yellow-500 hover:bg-yellow-600'}`}>{param.toUpperCase()}: {dosings[param]}ml {dosingStatus[`${log.id}-${param}`] ? 'âœ”ï¸ ë„ì§• ì™„ë£Œ' : 'â“ ë„ì§• ì˜ˆì •'}</button></div> ))} {Object.keys(dosings).length === 0 && <p className="text-sm text-gray-400">ëª¨ë“  ìˆ˜ì¹˜ê°€ ì•ˆì •ì ì…ë‹ˆë‹¤. (ë„ì§• í•„ìš” ì—†ìŒ)</p>} <button onClick={() => toggleDosingStatus(log.id, 'bacter')} className={`py-1 px-3 rounded-lg text-xs font-bold ${dosingStatus[`${log.id}-bacter`] ? 'bg-green-600' : 'bg-purple-600 hover:bg-purple-700'}`}>{dosingStatus[`${log.id}-bacter`] ? 'âœ”ï¸ ë°•í„°ì˜¤ë¦¬ì§„ ë„ì§•ì™„ë£Œ' : 'ë°•í„°ì˜¤ë¦¬ì§„ ë„ì§•'}</button> </div> </div> {log.notes && <p className="mt-3 text-gray-300 text-sm"><span className="font-semibold">ğŸ“ íŠ¹ì´ì‚¬í•­:</span> {log.notes}</p>} </div> ) }) : <div className="text-center text-gray-500 py-8">í•´ë‹¹ ê¸°ê°„ì˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>} </div> </main> {(isLoadingAnalysis || analysisResult) && ( <div className="fixed bottom-0 right-0 m-8 w-full max-w-md bg-gray-800 border-2 border-blue-500 rounded-xl shadow-2xl z-50"> <div className="p-4 border-b border-gray-700"> <h3 className="text-lg font-bold text-blue-400"> {analysisResult ? `${analysisResult.logDate} ê¸°ë¡ì— ëŒ€í•œ AI ë¶„ì„` : "AI ë¶„ì„"} </h3> </div> <div className="p-4 h-80 overflow-y-auto"> {isLoadingAnalysis ? ( <div className="flex items-center justify-center h-full"> <div className="loader"></div> <p className="ml-4">Gemini AIê°€ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p> </div> ) : ( <pre className="text-sm text-gray-300 whitespace-pre-wrap font-sans">{analysisResult.text}</pre> )} </div> <div className="p-2 border-t border-gray-700 text-right"> <button onClick={() => setAnalysisResult(null)} className="text-xs text-gray-400 hover:text-white">ë‹«ê¸°</button> </div> </div> )} </div> </div> );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
