<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>해수어항 관리 도징 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .result-item { padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 0.5rem; font-weight: 500; }
    .result-good  { background-color: #E6FFFA; color: #234E52; border-left: 4px solid #38B2AC; }
    .result-low   { background-color: #FFF5F5; color: #C53030; border-left: 4px solid #FC8181; }
    .result-high  { background-color: #FAF5FF; color: #6B46C1; border-left: 4px solid #B794F4; }
    .result-action{ background-color: #FEFCBF; color: #744210; border-left: 4px solid #F6E05E; }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4 max-w-5xl">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- 입력 영역 -->
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">어항 정보 입력</h2>
        <div class="grid grid-cols-2 gap-3">
          <input id="date" type="date" class="border p-2 rounded" />
          <input id="vol" placeholder="용량(L)" class="border p-2 rounded" />
          <input id="temp" placeholder="온도(°C)" class="border p-2 rounded" />
          <input id="salinity" placeholder="염도(ppt)" class="border p-2 rounded" />
          <input id="ph" placeholder="pH" class="border p-2 rounded" />
          <input id="ca" placeholder="Ca(ppm)" class="border p-2 rounded" />
          <input id="mg" placeholder="Mg(ppm)" class="border p-2 rounded" />
          <input id="kh" placeholder="KH(dKH)" class="border p-2 rounded" />
          <input id="no2" placeholder="NO₂(ppm)" class="border p-2 rounded" />
          <input id="no3" placeholder="NO₃(ppm)" class="border p-2 rounded" />
          <input id="po4" placeholder="PO₄(ppm)" class="border p-2 rounded" />
        </div>
        <div class="flex space-x-2 mt-4">
          <button id="calculate-btn" class="flex-1 bg-blue-600 text-white py-2 rounded">계산하기</button>
          <button id="save-btn" class="flex-1 bg-green-600 text-white py-2 rounded">기록 저장</button>
        </div>
      </div>

      <!-- 결과 영역 -->
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">계산 결과 및 권장 사항</h2>
        <div id="results-output" class="space-y-2"></div>
      </div>
    </div>

    <!-- 저장된 기록 영역 -->
    <div class="mt-8 bg-white p-6 rounded shadow">
      <div class="flex justify-between mb-4">
        <h2 class="text-xl font-bold">저장된 기록</h2>
        <div class="space-x-2">
          <button id="show-graph-btn" class="bg-indigo-500 text-white px-4 py-2 rounded">그래프 보기</button>
          <button id="clear-logs-btn" class="bg-red-500 text-white px-4 py-2 rounded">기록 초기화</button>
        </div>
      </div>
      <table class="w-full text-sm">
        <thead><tr><th>날짜</th><th>온도</th><th>염도</th><th>pH</th><th>Ca</th><th>Mg</th><th>KH</th><th>NO₂</th><th>NO₃</th><th>PO₄</th><th>삭제</th></tr></thead>
        <tbody id="log-table-body"></tbody>
      </table>
    </div>
  </div>

  <script>
    const targets = {
      temp: {min: 25.5, max: 26.5},
      salinity: {min: 34, max: 35},
      ph: {min: 8.0, max: 8.3},
      ca: {min: 400, target: 420},
      mg: {min: 1300, target: 1350},
      kh: {min: 7.3, target: 8.0},
      no2: {max: 0.01},
      no3: {min: 0.5, max: 2.0, target: 1.0},
      po4: {min: 0.03, max: 0.07, target: 0.04}
    };

    const roundDose = x => Math.round(x * 10) / 10;

    document.getElementById('calculate-btn').addEventListener('click', () => {
      console.clear();
      console.log('계산 시작');
      const vol = parseFloat(document.getElementById('vol').value || '160');
      const inputs = {};
      ['temp','salinity','ph','ca','mg','kh','no2','no3','po4'].forEach(id => {
        inputs[id] = parseFloat(document.getElementById(id).value);
      });
      const output = document.getElementById('results-output');
      output.innerHTML = '';

      for (let [key, val] of Object.entries(inputs)) {
        const t = targets[key];
        if (val === undefined || isNaN(val)) continue;
        let div = document.createElement('div');
        let cls = 'result-good', msg = '';
        if (key === 'no2' && val > t.max) {
          cls = 'result-action';
          msg = 'NO₂: 검출됨! 즉시 20% 환수를 권장합니다.';
        } else if (key === 'no3' || key === 'po4') {
          if (val < t.min) {
            const delta = t.target - val;
            const dose = roundDose(vol * delta / (key === 'no3' ? 100 * 0.03 : 100 * 0.001));
            cls = 'result-low';
            msg = `${key.toUpperCase()}: 낮음. 목표치(${t.target})까지 ${delta.toFixed(2)}ppm 올리려면 약 ${dose}ml 도징 필요.`;
          } else if (val > t.max) {
            cls = 'result-high';
            msg = `${key.toUpperCase()}: 높음. 20% 환수 또는 리무버 사용 권장합니다.`;
          } else {
            msg = `${key.toUpperCase()}: 안정적 수치입니다.`;
          }
        } else if (t.min !== undefined && val < t.min) {
          if (key === 'ca' || key === 'mg' || key === 'kh') {
            const delta = t.target - val;
            const factor = key === 'ca' ? 2 : (key === 'mg' ? 1 : 0.1);
            const dose = roundDose((vol * delta) / (100 * factor));
            msg = `${key.toUpperCase()}: 낮음. 목표치(${t.target})까지 ${val}ppm 올리려면 약 ${dose}ml 도징 필요. (매일 약 ${(dose/7).toFixed(1)}ml × 7일 권장)`;
            cls = 'result-low';
          } else {
            msg = `${key.toUpperCase()}: 낮음. 목표 범위(${t.min}~${t.max})로 조절해주세요.`;
            cls = 'result-low';
          }
        } else if (t.max !== undefined && val > t.max) {
          msg = `${key.toUpperCase()}: 높음. 목표 범위(${t.min}~${t.max})로 조절해주세요.`;
          cls = 'result-high';
        } else {
          msg = `${key.toUpperCase()}: 안정적 수치입니다.`;
        }
        div.className = `result-item ${cls}`;
        div.textContent = msg;
        output.appendChild(div);
        console.log(msg);
      }
    });
  </script>
</body>
</html>
