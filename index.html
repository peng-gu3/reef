<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ì‹ ë§¤ë§¤ì¼ì§€</title>
<link rel="stylesheet" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"/>
<style>
:root{
--primary:#2563eb;
--red:#b91c1c; --blue:#1d4ed8;
--gray:#64748b; --green:#16a34a;
--bg:#f8fafc; --card:#fff; --border:#e2e8f0;
}
body{font-family:Pretendard,sans-serif;background:var(--bg);margin:0;padding:30px}
.container{max-width:1100px;margin:auto}
h1{margin:0 0 15px}

.calendar{background:#fff;padding:20px;border-radius:14px;border:1px solid var(--border);
display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
.day-header{text-align:center;font-weight:600;color:#64748b}
.day{border:1px solid var(--border);border-radius:12px;min-height:120px;padding:8px;cursor:pointer}
.day:hover{border-color:var(--primary)}
.day-num{font-weight:700;color:#475569}

.badge{font-size:11px;margin-top:4px;padding:4px 6px;border-radius:6px}
.buy{background:#fee2e2;color:var(--red)}
.sellP{background:#fff1f2;color:#be123c}
.sellL{background:#eff6ff;color:var(--blue)}
.deposit{background:#f0fdf4;color:var(--green);border-left:3px solid var(--green)}

.panel{margin-top:20px;background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px}
.panel h3{margin:0 0 10px;font-size:15px}

.log{border:1px solid var(--border);border-radius:10px;padding:8px;margin-bottom:6px;
display:flex;justify-content:space-between;align-items:center}
.log small{color:#64748b}

button{cursor:pointer}
.action{background:#eff6ff;color:#1d4ed8;border:none;border-radius:6px;padding:4px 8px}
.delete{border:none;background:none;color:#cbd5e1;font-size:18px}

.modal-overlay{display:none;position:fixed;inset:0;background:rgba(15,23,42,.4);
backdrop-filter:blur(4px);justify-content:center;align-items:center}
.modal{background:#fff;border-radius:18px;width:460px;max-width:95%}
.modal-header{padding:14px 18px;border-bottom:1px solid var(--border);
display:flex;justify-content:space-between}
.modal-body{padding:18px}
.form-group{margin-bottom:12px}
label{font-size:13px;font-weight:600}
input,select{width:100%;padding:9px;border-radius:8px;border:1px solid var(--border)}
.btns{display:flex;gap:10px}
.save{background:#111827;color:#fff;border:none;border-radius:8px;padding:10px}
.close{background:#e5e7eb;border:none;border-radius:8px;padding:10px}
</style>
</head>

<body>
<div class="container">
<h1>í•˜ë£¨ 20ë§Œ ëª©í‘œ!!!</h1>

<div id="calendar" class="calendar"></div>

<div class="panel">
<h3 id="selDateTitle">ğŸ“… ë‚ ì§œ ì„ íƒ</h3>
<div id="dayLogs"></div>
</div>

<div class="panel">
<h3>ğŸ“¦ ë³´ìœ  ì¢…ëª©</h3>
<div id="holdings"></div>
</div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal">
<div class="modal">
<div class="modal-header">
<h3>ê±°ë˜ ì…ë ¥</h3>
<button onclick="closeM()">Ã—</button>
</div>
<div class="modal-body">
<div class="form-group">
<label>ë‚ ì§œ</label>
<input type="date" id="fDate">
</div>

<div class="form-group">
<label>êµ¬ë¶„</label>
<select id="fType" onchange="typeChange()">
<option value="buy">ë§¤ìˆ˜</option>
<option value="sell">ë§¤ë„</option>
<option value="other">ê¸°íƒ€(ì˜ˆìˆ˜ê¸ˆ)</option>
</select>
</div>

<div class="form-group">
<label id="nameLabel">ì¢…ëª©ëª…</label>
<input id="fName">
</div>

<div class="form-group" id="priceGroup">
<label id="priceLabel">ë‹¨ê°€</label>
<input type="number" id="fPrice">
</div>

<div class="form-group" id="qtyGroup">
<label>ìˆ˜ëŸ‰(ì£¼)</label>
<input type="number" id="fQty" value="1">
</div>

<div class="btns">
<button class="close" onclick="closeM()">ì·¨ì†Œ</button>
<button class="save" onclick="save()">ì €ì¥</button>
</div>
</div>
</div>
</div>

<script>
let cur=new Date();
let tx=JSON.parse(localStorage.getItem('stock_full'))||[];
let selDate=null;
let sellLink=null;

function $(i){return document.getElementById(i)}

function openM(d){
$('modal').style.display='flex';
$('fDate').value=d;
$('fType').value='buy';
$('fName').value='';
$('fPrice').value='';
$('fQty').value=1;
sellLink=null;
typeChange();
}
function closeM(){ $('modal').style.display='none' }

function typeChange(){
let t=$('fType').value;
$('qtyGroup').style.display = t==='other'?'none':'block';
$('priceLabel').innerText = t==='other'?'ê¸ˆì•¡(+/-)':'ë‹¨ê°€';
$('nameLabel').innerText = t==='other'?'ë‚´ìš©':'ì¢…ëª©ëª…';
}

function save(){
let d=$('fDate').value,t=$('fType').value,n=$('fName').value;
let p=Number($('fPrice').value),q=Number($('fQty').value||1);
if(!d||!n||!p)return alert('ì…ë ¥ í™•ì¸');

if(t==='buy'){
tx.push({id:Date.now(),date:d,type:'buy',name:n,price:p,qty:q,remain:q});
}
else if(t==='sell' && sellLink){
if(q>sellLink.remain)return alert('ìˆ˜ëŸ‰ ì´ˆê³¼');
tx.push({id:Date.now(),date:d,type:'sell',name:n,price:p,qty:q,
profit:(p-sellLink.price)*q,link:sellLink.id});
sellLink.remain-=q;
}
else if(t==='other'){
tx.push({id:Date.now(),date:d,type:'other',name:n,price:p});
}

localStorage.setItem('stock_full',JSON.stringify(tx));
closeM(); render(); renderDay(selDate); renderHold();
}

function render(){
let cal=$('calendar');
cal.innerHTML='';
['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>cal.innerHTML+=`<div class="day-header">${d}</div>`);
let y=cur.getFullYear(),m=cur.getMonth();
for(let i=0;i<new Date(y,m,1).getDay();i++)cal.innerHTML+='<div></div>';
for(let d=1;d<=new Date(y,m+1,0).getDate();d++){
let ds=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
let logs=tx.filter(x=>x.date===ds);
let h=`<div class="day" onclick="selectDay('${ds}')"><div class="day-num">${d}</div>`;
logs.forEach(l=>{
if(l.type==='buy')h+=`<div class="badge buy">${l.name}</div>`;
if(l.type==='sell')h+=`<div class="badge ${l.profit>=0?'sellP':'sellL'}">${l.name}</div>`;
if(l.type==='other'&&l.price>0)h+=`<div class="badge deposit">${l.name}</div>`;
});
cal.innerHTML+=h+'</div>';
}
}

function selectDay(d){
selDate=d;
$('selDateTitle').innerText=`ğŸ“… ${d} ê¸°ë¡`;
renderDay(d);
}

function renderDay(d){
let box=$('dayLogs');
let logs=tx.filter(x=>x.date===d);
if(logs.length===0)return box.innerHTML='<small>ê¸°ë¡ ì—†ìŒ</small>';
box.innerHTML='';
logs.forEach(l=>{
box.innerHTML+=`
<div class="log">
<div>
<strong>${l.type==='buy'?'[ë§¤ìˆ˜]':l.type==='sell'?'[ë§¤ë„]':'[ê¸°íƒ€]'}</strong>
${l.name}<br>
<small>${l.type==='other'?l.price.toLocaleString():
l.price+' Ã— '+l.qty}</small>
</div>
<button class="delete" onclick="del(${l.id})">Ã—</button>
</div>`;
});
}

function renderHold(){
let h=$('holdings');
let holds=tx.filter(x=>x.type==='buy'&&x.remain>0);
h.innerHTML=holds.length?'':'<small>ë³´ìœ  ì—†ìŒ</small>';
holds.forEach(b=>{
h.innerHTML+=`
<div class="log">
<div><strong>${b.name}</strong><br><small>${b.remain}ì£¼ @ ${b.price}</small></div>
<button class="action" onclick="sellNow(${b.id})">ë§¤ë„</button>
</div>`;
});
}

function sellNow(id){
let b=tx.find(x=>x.id===id);
sellLink=b;
$('fType').value='sell';
$('fName').value=b.name;
$('fQty').value=b.remain;
$('fDate').value=selDate||b.date;
typeChange();
$('modal').style.display='flex';
}

function del(id){
tx=tx.filter(x=>x.id!==id);
localStorage.setItem('stock_full',JSON.stringify(tx));
render(); renderDay(selDate); renderHold();
}

render(); renderHold();
</script>
</body>
</html>
