<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>해수어항 관리 도징 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .result-item { padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 0.5rem; font-weight: 500; }
    .result-good  { background-color: #E6FFFA; color: #234E52; border-left: 4px solid #38B2AC; }
    .result-low   { background-color: #FFF5F5; color: #C53030; border-left: 4px solid #FC8181; }
    .result-high  { background-color: #FAF5FF; color: #6B46C1; border-left: 4px solid #B794F4; }
    .result-action{ background-color: #FEFCBF; color: #744210; border-left: 4px solid #F6E05E; }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4 max-w-6xl">
    <!-- 어항 정보 입력 영역 -->
    <div class="bg-white p-6 rounded shadow mb-6">
      <h2 class="text-xl font-bold mb-4">어항 정보 입력</h2>
      <div class="grid grid-cols-2 gap-3">
        <input id="date" type="date" class="border p-2 rounded" />
        <input id="vol" placeholder="용량(L)" class="border p-2 rounded" value="160" />
        <input id="temp" placeholder="온도(°C)" class="border p-2 rounded" />
        <input id="salinity" placeholder="염도(ppt)" class="border p-2 rounded" />
        <input id="ph" placeholder="pH" class="border p-2 rounded" />
        <input id="ca" placeholder="Ca(ppm)" class="border p-2 rounded" />
        <input id="mg" placeholder="Mg(ppm)" class="border p-2 rounded" />
        <input id="kh" placeholder="KH(dKH)" class="border p-2 rounded" />
        <input id="no2" placeholder="NO₂(ppm)" class="border p-2 rounded" />
        <input id="no3" placeholder="NO₃(ppm)" class="border p-2 rounded" />
        <input id="po4" placeholder="PO₄(ppm)" class="border p-2 rounded" />
      </div>
      <div class="flex flex-wrap space-x-2 mt-4">
        <button id="calculate-btn" class="flex-1 bg-blue-600 text-white py-2 rounded">계산하기</button>
        <button id="save-btn" class="flex-1 bg-green-600 text-white py-2 rounded">기록 저장</button>
        <button id="graph-btn" class="flex-1 bg-purple-600 text-white py-2 rounded">그래프 보기</button>
        <button id="ai-btn" class="flex-1 bg-indigo-600 text-white py-2 rounded">AI 어드바이스</button>
        <button id="clear-logs-btn" class="flex-1 bg-red-500 text-white py-2 rounded">기록 초기화</button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">계산 결과 및 권장 사항</h2>
        <div id="results-output" class="space-y-2"></div>
      </div>

      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">저장된 기록</h2>
        <table class="w-full text-sm">
          <thead><tr><th>날짜</th><th>온도</th><th>염도</th><th>pH</th><th>Ca</th><th>Mg</th><th>KH</th><th>NO₂</th><th>NO₃</th><th>PO₄</th><th>삭제</th></tr></thead>
          <tbody id="log-table-body"></tbody>
        </table>
      </div>
    </div>

  <script>
    const 기준 = {
      temp: [25.5, 26.5],
      salinity: [34, 35],
      ph: [8.0, 8.3],
      ca: [415, 430],
      mg: [1400, 1440],
      kh: [7.7, 8.0],
      no2: [0, 0],
      no3: [0.5, 2.0],
      po4: [0.03, 0.08]
    };

    document.getElementById('calculate-btn').addEventListener('click', () => {
      const fields = ['temp','salinity','ph','ca','mg','kh','no2','no3','po4'];
      const resultBox = document.getElementById('results-output');
      resultBox.innerHTML = '';
      fields.forEach(id => {
        const val = parseFloat(document.getElementById(id).value);
        if (!isNaN(val)) {
          const [min, max] = 기준[id];
          let msg = '', cls = '';
          if (val < min) {
            cls = 'result-low'; msg = `${id.toUpperCase()}: ${val} → 기준 미달. 보충 권장.`;
          } else if (val > max) {
            cls = 'result-high'; msg = `${id.toUpperCase()}: ${val} → 기준 초과. 감량 권장.`;
          } else {
            cls = 'result-good'; msg = `${id.toUpperCase()}: ${val} → 안정적 수치입니다.`;
          }
          resultBox.innerHTML += `<div class='result-item ${cls}'>${msg}</div>`;
        }
      });
    });

    document.getElementById('save-btn').addEventListener('click', () => {
      const row = document.createElement('tr');
      const fields = ['date','temp','salinity','ph','ca','mg','kh','no2','no3','po4'];
      fields.forEach(id => {
        const td = document.createElement('td');
        td.textContent = document.getElementById(id).value;
        row.appendChild(td);
      });
      const del = document.createElement('td');
      const btn = document.createElement('button');
      btn.textContent = '삭제';
      btn.className = 'text-red-500';
      btn.onclick = () => row.remove();
      del.appendChild(btn);
      row.appendChild(del);
      document.getElementById('log-table-body').appendChild(row);
    });

    document.getElementById('clear-logs-btn').addEventListener('click', () => {
      document.getElementById('log-table-body').innerHTML = '';
    });

    document.getElementById('graph-btn').addEventListener('click', () => {
      const labels = [], caArr = [], mgArr = [], khArr = [];
      const rows = document.querySelectorAll('#log-table-body tr');
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        labels.push(cells[0]?.textContent || '');
        caArr.push(Number(cells[4]?.textContent) || 0);
        mgArr.push(Number(cells[5]?.textContent) || 0);
        khArr.push(Number(cells[6]?.textContent) || 0);
      });
      const win = window.open('', 'Graph', 'width=1000,height=600');
      win.document.write('<h2>그래프 보기</h2><canvas id="chart"></canvas><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script>new Chart(document.getElementById("chart"), {type: "line", data: {labels: ' + JSON.stringify(labels) + ', datasets: [{label: "Ca", data: ' + JSON.stringify(caArr) + ', borderColor: "#60A5FA", fill: false}, {label: "Mg", data: ' + JSON.stringify(mgArr) + ', borderColor: "#34D399", fill: false}, {label: "KH", data: ' + JSON.stringify(khArr) + ', borderColor: "#FBBF24", fill: false}]}, options: {responsive: true}});<\/script>');
    });

    document.getElementById('ai-btn').addEventListener('click', () => {
      const ca = parseFloat(document.getElementById('ca').value);
      const mg = parseFloat(document.getElementById('mg').value);
      const kh = parseFloat(document.getElementById('kh').value);
      let tips = '<h2>AI 어드바이스</h2><ul>';
      if (ca < 415) tips += '<li>칼슘(Ca) 수치가 낮습니다. 도징을 시작하세요.</li>';
      if (mg < 1400) tips += '<li>마그네슘(Mg)이 기준 미달입니다. 보충 필요.</li>';
      if (kh < 7.7) tips += '<li>KH 수치가 낮습니다. 알카리니티 도징 권장.</li>';
      if (tips === '<h2>AI 어드바이스</h2><ul>') tips += '<li>모든 수치가 안정적입니다. 유지하세요.</li>';
      tips += '</ul>';
      const win = window.open('', 'AI', 'width=600,height=400');
      win.document.write(tips);
    });
  </script>
</body>
</html>
