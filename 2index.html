<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìˆ˜ì…Â·ì§€ì¶œ ë‹¬ë ¥ ê´€ë¦¬ëŒ€ì¥</title>
  <style>
    :root {
      --bg: radial-gradient(circle at 20% 20%, #f4f8ff, #f8fbff 35%, #eef2ff 65%, #eaf0ff);
      --card: #ffffff;
      --line: #e4e7ee;
      --text: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
      --success: #15803d;
      --danger: #dc2626;
      --shadow: 0 15px 40px rgba(15, 23, 42, 0.08);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 28px 18px 48px;
      font-family: "Pretendard", "Noto Sans KR", system-ui, -apple-system, Segoe UI, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    header { margin-bottom: 16px; display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    h1 { margin: 0 0 4px; font-size: 26px; letter-spacing: -0.4px; }
    .muted { color: var(--muted); font-size: 14px; }
    .layout { display: grid; grid-template-columns: 1.4fr 1fr; gap: 16px; align-items: start; }
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 16px 18px;
      box-shadow: var(--shadow);
    }
    .card h2 { margin: 0 0 10px; font-size: 18px; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .calendar-nav button {
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 10px;
      padding: 8px 10px;
      cursor: pointer;
      font-weight: 700;
    }
    .calendar-nav button:hover { background: #eef2ff; border-color: #d5ddff; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
    .weekday { text-align: center; font-size: 12px; color: var(--muted); font-weight: 700; }
    .day {
      min-height: 90px;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: #fff;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      cursor: pointer;
      transition: border 0.15s ease, box-shadow 0.15s ease;
    }
    .day:hover { border-color: #cfd6e9; box-shadow: 0 4px 10px rgba(15, 23, 42, 0.05); }
    .day.disabled { background: #fafafa; color: #d5d8df; cursor: default; }
    .day-header { display: flex; justify-content: space-between; align-items: center; }
    .badge { border-radius: 999px; padding: 3px 8px; font-size: 12px; font-weight: 800; border: 1px solid transparent; }
    .income { background: rgba(21,128,61,0.12); color: var(--success); border-color: rgba(21,128,61,0.22); }
    .expense { background: rgba(220,38,38,0.12); color: var(--danger); border-color: rgba(220,38,38,0.22); }
    .selected { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(37,99,235,0.18); }
    .totals { display: grid; grid-template-columns: repeat(auto-fit, minmax(190px, 1fr)); gap: 12px; margin: 6px 0 14px; }
    .total-box { border: 1px dashed var(--line); border-radius: 12px; padding: 12px 14px; background: linear-gradient(135deg, #f9fbff, #f2f6ff); box-shadow: inset 0 1px 0 rgba(255,255,255,0.6); }
    .total-box strong { display: block; margin-top: 6px; font-size: 18px; }
    form { display: flex; flex-direction: column; gap: 10px; }
    label { font-size: 13px; font-weight: 700; color: #374151; }
    input, select, textarea {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 14px;
      background: #fff;
    }
    input[type="number"] { text-align: right; }
    textarea { resize: vertical; min-height: 62px; }
    .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .btn { border: none; background: var(--primary); color: #fff; padding: 12px; border-radius: 12px; font-weight: 800; cursor: pointer; }
    .btn:hover { background: #1d4ed8; }
    .list { border-top: 1px solid var(--line); margin-top: 10px; }
    .item { display: grid; grid-template-columns: 1fr auto; gap: 8px; padding: 9px 0; border-bottom: 1px solid var(--line); align-items:center; }
    .item strong { display: block; }
    .chip { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 12px; border: 1px solid var(--line); background: #f4f6fb; margin-right: 6px; }
    .empty { padding: 12px 0; color: #9ca3af; text-align: center; }
    .section-head { display: flex; justify-content: space-between; align-items: center; }
    .controls { display:flex; align-items:center; gap:8px; }
    .pill-btn { border: 1px solid var(--line); background:#fff; border-radius: 999px; padding:6px 10px; font-size:12px; cursor:pointer; }
    .pill-btn:hover { border-color:#cfd6e9; background:#f8fafc; }
    .tag { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:12px; font-size:12px; background:rgba(37,99,235,0.06); color:var(--primary); font-weight:700; }
    .btn.secondary { background:#fff; color:var(--text); border:1px solid var(--line); }
    .btn.secondary:hover { background:#f8fafc; }
    .action { display:inline-flex; align-items:center; gap:4px; padding:6px 10px; font-size:12px; border-radius:10px; border:1px solid var(--line); cursor:pointer; background:#fff; }
    .action.edit { color:var(--primary); }
    .action.delete { color:var(--danger); }
    .action:hover { background:#f8fafc; }
    .overall { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px; margin-top:8px; }
    @media (max-width: 1024px) { .layout { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header>
    <h1>ìˆ˜ì…Â·ì§€ì¶œ ë‹¬ë ¥ ê´€ë¦¬ëŒ€ì¥</h1>
    <div class="tag">ë‹¬ë ¥ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•˜ê³  ì…ë ¥ë§Œ í•˜ë©´ ì¼Â·ì›”Â·ì´í•©ì´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</div>
  </header>

  <section class="card">
    <div class="section-head">
      <h2 style="margin:0;">í˜„í™© í•œëˆˆì—</h2>
      <div class="muted" id="monthInfo"></div>
    </div>
    <div class="overall" id="overallTotals"></div>
    <div class="totals" id="monthlyTotals"></div>
  </section>

  <div class="layout">
    <section class="card">
      <div class="calendar-header">
        <div>
          <strong id="monthLabel"></strong>
          <div class="muted" id="monthSub"></div>
        </div>
        <div class="calendar-nav">
          <button type="button" onclick="changeMonth(-1)">â—€ ì´ì „ ë‹¬</button>
          <button type="button" onclick="changeMonth(1)">ë‹¤ìŒ ë‹¬ â–¶</button>
        </div>
      </div>
      <div class="calendar-grid" id="weekdayRow"></div>
      <div class="calendar-grid" id="calendar"></div>
    </section>

    <section class="card">
      <div class="section-head">
        <h2 style="margin:0;">ì…ë ¥ Â· ì„ íƒì¼ ìš”ì•½</h2>
        <div class="muted" id="selectedTitle"></div>
      </div>
      <form id="entryForm">
        <div class="form-row">
          <div>
            <label for="entryDate">ë‚ ì§œ</label>
            <input type="date" id="entryDate" required />
          </div>
          <div>
            <label for="entryType">êµ¬ë¶„</label>
            <select id="entryType" required>
              <option value="income">ìˆ˜ì…</option>
              <option value="expense">ì§€ì¶œ</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div>
            <label for="entryCategory">í•­ëª©</label>
            <input type="text" id="entryCategory" placeholder="ì˜ˆ: ì›”ê¸‰, ì‹ë¹„" required />
          </div>
          <div>
            <label for="entryAmount">ê¸ˆì•¡ (ì›)</label>
            <input type="number" id="entryAmount" min="0" step="1" inputmode="decimal" placeholder="0" required />
          </div>
        </div>
        <div>
          <label for="entryNote">ë©”ëª¨ (ì„ íƒ)</label>
          <textarea id="entryNote" placeholder="ì„¸ë¶€ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>
        </div>
        <div class="controls">
          <button class="btn" id="submitBtn" type="submit">ê¸°ë¡ ì¶”ê°€</button>
          <button class="btn secondary" id="cancelEdit" type="button" style="display:none;">ì·¨ì†Œ</button>
        </div>
      </form>
      <div class="list" id="daySummary"></div>
    </section>
  </div>

  <script>
    const weekdayRow = document.getElementById('weekdayRow');
    const calendar = document.getElementById('calendar');
    const monthLabel = document.getElementById('monthLabel');
    const monthSub = document.getElementById('monthSub');
    const monthInfo = document.getElementById('monthInfo');
    const monthlyTotals = document.getElementById('monthlyTotals');
    const overallTotals = document.getElementById('overallTotals');
    const selectedTitle = document.getElementById('selectedTitle');
    const entryForm = document.getElementById('entryForm');
    const submitBtn = document.getElementById('submitBtn');
    const cancelEdit = document.getElementById('cancelEdit');
    const entryDate = document.getElementById('entryDate');
    const entryType = document.getElementById('entryType');
    const entryCategory = document.getElementById('entryCategory');
    const entryAmount = document.getElementById('entryAmount');
    const entryNote = document.getElementById('entryNote');
    const daySummary = document.getElementById('daySummary');

    const WEEKDAYS = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    let current = new Date();
    let selectedDate = new Date();
    let entries = loadEntries();
    let editingId = null;

    function loadEntries() {
      const raw = localStorage.getItem('ledgerEntries');
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        console.warn('ê¸°ì¡´ ì €ì¥ëœ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì´ˆê¸°í™”í•©ë‹ˆë‹¤.', e);
        return [];
      }
    }
    function persistEntries() {
      localStorage.setItem('ledgerEntries', JSON.stringify(entries));
    }
    function formatKRW(value) {
      return Number(value || 0).toLocaleString('ko-KR');
    }
    function renderWeekdays() {
      weekdayRow.innerHTML = WEEKDAYS.map(d => `<div class="weekday">${d}</div>`).join('');
    }
    function daysInMonth(date) { return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate(); }
    function isSameDay(a, b) {
      return a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate();
    }
    function isSameMonth(a, b) {
      return a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth();
    }
    function toInputDate(date) {
      const mm = String(date.getMonth() + 1).padStart(2, '0');
      const dd = String(date.getDate()).padStart(2, '0');
      return `${date.getFullYear()}-${mm}-${dd}`;
    }
    function entryTimeLabel(dateStr) {
      const date = new Date(dateStr);
      const hh = String(date.getHours()).padStart(2, '0');
      const mm = String(date.getMinutes()).padStart(2, '0');
      return `${hh}:${mm}`;
    }
    function sumByType(arr, type) {
      return arr.filter(e => e.type === type).reduce((sum, cur) => sum + Number(cur.amount || 0), 0);
    }

    function changeMonth(delta) {
      current = new Date(current.getFullYear(), current.getMonth() + delta, 1);
      selectedDate = new Date(current.getFullYear(), current.getMonth(), Math.min(selectedDate.getDate(), daysInMonth(current)));
      render();
    }

    function render() {
      renderHeader();
      renderOverallTotals();
      renderCalendar();
      renderMonthTotals();
      renderDaySummary(selectedDate);
      entryDate.value = toInputDate(selectedDate);
    }

    function renderHeader() {
      const formatter = new Intl.DateTimeFormat('ko', { year: 'numeric', month: 'long' });
      monthLabel.textContent = formatter.format(current);
      const monthEntries = entries.filter(e => isSameMonth(new Date(e.date), current));
      monthSub.textContent = `${monthEntries.length}ê±´ ê¸°ë¡ë¨`;
      monthInfo.textContent = `${current.getFullYear()}ë…„ ${current.getMonth() + 1}ì›” ê¸°ì¤€`;
    }

    function renderOverallTotals() {
      const totalIncome = sumByType(entries, 'income');
      const totalExpense = sumByType(entries, 'expense');
      const totalBalance = totalIncome - totalExpense;
      overallTotals.innerHTML = `
        <div class="total-box">
          <span class="muted">ì „ì²´ ëˆ„ì  ìˆ˜ì…</span>
          <strong style="color:var(--success);">+ ${formatKRW(totalIncome)}ì›</strong>
        </div>
        <div class="total-box">
          <span class="muted">ì „ì²´ ëˆ„ì  ì§€ì¶œ</span>
          <strong style="color:var(--danger);">- ${formatKRW(totalExpense)}ì›</strong>
        </div>
        <div class="total-box">
          <span class="muted">ì „ì²´ ëˆ„ì  ì”ì•¡</span>
          <strong>${formatKRW(totalBalance)}ì›</strong>
        </div>
      `;
    }

    function renderCalendar() {
      const first = new Date(current.getFullYear(), current.getMonth(), 1);
      const days = daysInMonth(current);
      const startPadding = first.getDay();
      const cells = [];
      for (let i = 0; i < startPadding; i++) cells.push('<div class="day disabled"></div>');
      for (let day = 1; day <= days; day++) {
        const date = new Date(current.getFullYear(), current.getMonth(), day);
        const daily = entries.filter(e => isSameDay(new Date(e.date), date));
        const income = sumByType(daily, 'income');
        const expense = sumByType(daily, 'expense');
        const net = income - expense;
        const badges = [];
        if (income) badges.push(`<span class="badge income">+${formatKRW(income)}</span>`);
        if (expense) badges.push(`<span class="badge expense">-${formatKRW(expense)}</span>`);
        cells.push(`
          <div class="day ${isSameDay(date, selectedDate) ? 'selected' : ''}" data-date="${date.toISOString()}">
            <div class="day-header">
              <strong>${day}</strong>
              <div style="display:flex; gap:4px;">${badges.join('')}</div>
            </div>
            <div class="muted" style="font-size:12px;">ì”ì•¡: ${formatKRW(net)}ì›</div>
          </div>
        `);
      }
      calendar.innerHTML = cells.join('');
      calendar.querySelectorAll('.day').forEach(cell => {
        if (!cell.classList.contains('disabled')) {
          cell.addEventListener('click', () => {
            selectedDate = new Date(cell.dataset.date);
            render();
          });
        }
      });
    }

    function renderMonthTotals() {
      const monthEntries = entries.filter(e => isSameMonth(new Date(e.date), current));
      const income = sumByType(monthEntries, 'income');
      const expense = sumByType(monthEntries, 'expense');
      const balance = income - expense;
      monthlyTotals.innerHTML = `
        <div class="total-box">
          <span class="muted">ì´ ë‹¬ ì´ ìˆ˜ì…</span>
          <strong style="color:var(--success);">+ ${formatKRW(income)}ì›</strong>
        </div>
        <div class="total-box">
          <span class="muted">ì´ ë‹¬ ì´ ì§€ì¶œ</span>
          <strong style="color:var(--danger);">- ${formatKRW(expense)}ì›</strong>
        </div>
        <div class="total-box">
          <span class="muted">ì´ ë‹¬ ì”ì•¡</span>
          <strong>${formatKRW(balance)}ì›</strong>
        </div>
      `;
    }

    function renderDaySummary(date) {
      const todayEntries = entries.filter(e => isSameDay(new Date(e.date), date));
      const income = sumByType(todayEntries, 'income');
      const expense = sumByType(todayEntries, 'expense');
      const net = income - expense;
      const title = new Intl.DateTimeFormat('ko', { month: 'long', day: 'numeric', weekday: 'short' }).format(date);
      selectedTitle.textContent = `${title} í•©ê³„: ${formatKRW(net)}ì›`;

      if (!todayEntries.length) {
        daySummary.innerHTML = `<div class="empty">${title} ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì˜¤ë¥¸ìª½ì— ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.</div>`;
        return;
      }

      const list = todayEntries
        .sort((a,b) => new Date(a.createdAt || a.date) - new Date(b.createdAt || b.date))
        .map(entry => `
          <div class="item">
            <div>
              <div class="chip">${entry.type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'}</div>
              <strong>${entry.category}</strong>
              <div class="muted" style="font-size:12px;">${entry.note || 'ë©”ëª¨ ì—†ìŒ'}</div>
            </div>
            <div style="text-align:right;">
              <div style="font-weight:800;color:${entry.type === 'income' ? 'var(--success)' : 'var(--danger)'};">
                ${entry.type === 'income' ? '+' : '-'}${formatKRW(entry.amount)}ì›
              </div>
              <div class="muted" style="font-size:12px;">${entryTimeLabel(entry.date)}</div>
              <div style="margin-top:6px; display:flex; gap:6px; justify-content:flex-end;">
                <button class="action edit" type="button" data-id="${entry.id}">âœï¸ ìˆ˜ì •</button>
                <button class="action delete" type="button" data-id="${entry.id}">ğŸ—‘ ì‚­ì œ</button>
              </div>
            </div>
          </div>
        `).join('');

      daySummary.innerHTML = `
        <div style="padding:8px 0 6px; display:flex; justify-content:space-between;">
          <div><strong>${title}</strong></div>
          <div style="text-align:right;">
            <div class="muted">ìˆ˜ì… ${formatKRW(income)} | ì§€ì¶œ ${formatKRW(expense)}</div>
            <div style="font-weight:800;">ì”ì•¡ ${formatKRW(net)}ì›</div>
          </div>
        </div>
        ${list}
      `;

      daySummary.querySelectorAll('.action.edit').forEach(btn => {
        btn.addEventListener('click', () => startEditing(btn.dataset.id));
      });
      daySummary.querySelectorAll('.action.delete').forEach(btn => {
        btn.addEventListener('click', () => deleteEntry(btn.dataset.id));
      });
    }

    function startEditing(id) {
      const entry = entries.find(e => e.id === id);
      if (!entry) return;
      editingId = id;
      selectedDate = new Date(entry.date);
      entryDate.value = toInputDate(selectedDate);
      entryType.value = entry.type;
      entryCategory.value = entry.category;
      entryAmount.value = entry.amount;
      entryNote.value = entry.note || '';
      submitBtn.textContent = 'ê¸°ë¡ ìˆ˜ì •';
      cancelEdit.style.display = 'inline-flex';
      render();
    }

    function resetForm() {
      editingId = null;
      entryForm.reset();
      entryDate.value = toInputDate(selectedDate);
      submitBtn.textContent = 'ê¸°ë¡ ì¶”ê°€';
      cancelEdit.style.display = 'none';
    }

    function deleteEntry(id) {
      const target = entries.find(e => e.id === id);
      if (!target) return;
      if (!confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?')) return;
      entries = entries.filter(e => e.id !== id);
      if (editingId === id) resetForm();
      persistEntries();
      render();
    }

    entryForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const amount = Number(entryAmount.value);
      if (Number.isNaN(amount) || amount <= 0) {
        alert('ê¸ˆì•¡ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      const date = new Date(entryDate.value || new Date());
      if (editingId) {
        entries = entries.map(e => e.id === editingId ? {
          ...e,
          date: date.toISOString(),
          type: entryType.value,
          category: entryCategory.value.trim() || 'ê¸°íƒ€',
          amount,
          note: entryNote.value.trim(),
        } : e);
      } else {
        const entry = {
          id: crypto.randomUUID(),
          date: date.toISOString(),
          type: entryType.value,
          category: entryCategory.value.trim() || 'ê¸°íƒ€',
          amount,
          note: entryNote.value.trim(),
          createdAt: new Date().toISOString(),
        };
        entries.push(entry);
      }
      persistEntries();
      selectedDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
      resetForm();
      render();
    });

    cancelEdit.addEventListener('click', resetForm);

    renderWeekdays();
    entryDate.value = toInputDate(selectedDate);
    render();
  </script>
</body>
